Enumerating system information

- After gaining initial access to a target system, it is always important to learn more about the system like, what OS is running as well as the OS version. This information is very useful as it gives us an idea of what we can do and what type of exploits we can run
- What are we looking for 
	- Hostname
	- Distribution and distribution release version
	- Kernel version and architecture
	- CPU information
	- Disk information and mounted drives
	- Installed packages/softwares 

Lab details:
No GUI and only terminal
- `ifconfig` to see the IP address of your system and target is on the adjcent IP to your system.
- Perform a simple NMAP scan
- We see that it is running vsftpd 2.3.4 which has already got backdoor command execution vuln
- We can confirm the same with the help of searchsploit.
- Launch msfconsole and check postgres status if not started start the service and set the global rhost value.
- Once we run the module we can see that we get the actual shell and not the meterpreter in this case by running `vsftpd_234_backdoor`
- To get an interactive session `/bin/bash -i`
- Upgrading the session to meterpreter `sessions -u <seesion_id>` 
- with meterpreter `sysinfo`  launch `shell` and use `/bin/bash -i` go to root directory `hostname` to check the distribution `cat /etc/issue` `cat /etc/*release`
- Kernel version `uname -a` along with other information if we want to limit to only kernel version `uname -r`. For enviroment variables `env`
- CPU information `lscpu`
- RAM consumption `free -h`
- List drives `df -h`
- List drives `df -ht ext4` 
- `lsblk` display disk information
- Installed packages can be checked using dpkg `dpkg -l`

---

Enumerating users and groups

- After gaining initial access to a target system, it is always important to learn more about the system like, what user account you have access to and other user accounts on the system
- What are we looking for
	- Current user and privileges
	- Other users on the system
	- Groups

Lab details:
- Same old vsftpd234 backdoor in this lab as well exploit and launch a meterpreter session
- As we already got the root privileges we need to do anything further in this had it been that we logged in as other user to list the privileges of the user we logged in as use the command `groups <userAccount>` or simply `groups`  to see all the groups in the system.
- To see the other users we can refer the passwd file `cat /etc/passwd` if the users have a shell assigned it means it is a user account or else just a service account
- Structure of the user account in the passwd file is as follows

mark:x:1001:1001:mark,,,:/home/mark:/bin/bash
[--] - [--] [--] [-----] [--------] [--------]
|    |   |    |     |         |        |
|    |   |    |     |         |        +-> 7. Login shell
|    |   |    |     |         +----------> 6. Home directory
|    |   |    |     +--------------------> 5. GECOS
|    |   |    +--------------------------> 4. GID
|    |   +-------------------------------> 3. UID
|    +-----------------------------------> 2. Password
+----------------------------------------> 1. Username

- refer the man page for the useradd
- who, last and lastlog command

---

Enumerating network information

What are we looking for in this enumeration:
- Current IP and network adapter
- Internal networks
- TCP/UDP services running and their respective ports
- Other hosts on the network

Lab details:
- It has got the same vulnerability as the previous two target systems
- Run the command `ifconfig`
- `netstat` command to get list of TCP and UDP services we can identify services based on their state
- Next comes the `route` command and in the Gateway column we can identify the DHCP server or the Router default gateway IP on it.
- Once we open a shell and launch the bash session run the `ifconfig` again incase of failure run the `ip a s` command
- Or if both the commands fail to run use the `cat /etc/networks` file 
- You can get the host name from the `cat /etc/hostname` and `cat /etc/hosts` from here we can know the internal domains that we can access from the IP addresses we get from the file.
- We can get the DNS information from `cat /etc/resolv.conf` and is listed as nameserver
- Arp table will reveal other systems that are running on the network `arp -a` if it fails we can run the command in meterpreter simply by running `arp`

---

Enumerating Processes and Cron jobs

In this part of the linux lab we will trying to get information about the system like what processes, services and scheduled tasks are currently running

What are we looking for :
- Running services 
- Cron Jobs

Lab details:
- This lab has got the same vuln as the first lab and we can get the shell and meterpreter the same as we did earlier. Please do get on the meterpreter session and continue.
- To see the commands available for meterpreter just it ? and enter
- Use `ps` command to list all the processes that are running
- We can refer the system commands from the meterpreter
- Also we can use the `pgrep <services>` that way we can get the PID for the service you are looking for incase if the service is up and running.
- Launch a shell and /bin/bash -i 
- Command `ps aux` and `top` to see all the services that are running on the system
- `crontab -l` to see all the cron jobs for the user
- Also we can print the content of all cron tasks using `ls -la /etc/cron*` and check that

---

Automating Linux Local Enumeration

- In addition to performing local enumeration manually, we can also automate the process with the help of a few scripts and MSF modules.
- While local enumeration techniques/commands are important to know, as a penetration tester, you will need to be time efficient. As a result, you will need to learn how to utilize various automated enumeration scripts
- In addition to automating the process of enumerating information like system information, users and groups etc., these automated enumeration scripts will also provide you with additional information regarding target system like; privilege escalation vulnerabilities, locally stored passwords etc.
- LinEnum is a simple bash script that automates common linux local enumeration checks in addition to identifying privilege escalation vulnerabilities
- Github repo: https://github.com/rebootuser/LinEnum

Lab details:
- Run the command `ifconfig` or `ip a` to see the eth1 IP address and use the adjacent IP as the target IP address.
- Perform a NMAP default scan and check the service version as well.
- As we have seen that the target is running the Apache we check what kind of website is being hosted. And we see in the page that a `.cgi` is being rendered on page. It is vulnerable to shellshock vulnerability.
- Launch the metasploit framework and search for shellshock we will use exploit/multi/http/apache_mod_cgi_bash_env_exec 
- set the rhosts and the cgi path and run the script once the meterpreter session is obtained put the session in background.
- search for enum_configs and set session to the meterpreter session we obtained and run > we can get the hostname and the Linux kernel version, shells , ldap , and saved copy location
- search enum_network and run the module by setting up the session all the saved data can be referred from the loot > routing table
- search enum_system set the session and run the module > we get system information and linux information, user accounts, Running services, Cron jobs, Disk info, Logfiles and all the other information is stored.
- search check_vm to see if the target machine is a virtual machine or not and we need to use the target specific version.
- In order to launch the LinEnum script we will now restore the session with the meterpreter and store the LinEnum script in the tmp directory and change the permission of the script and run it from the bash shell we will be getting the output in couple of seconds to minutes based on the internet speed.