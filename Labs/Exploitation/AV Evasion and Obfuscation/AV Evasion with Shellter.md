Defense Evasion

Defense evasion consists of techniques that adversaries use to avoid detection throughout their compromise. Techniques used for defense evasion include uninstalling/disabling security software or obfuscating/encrypting data and scripts. Adversaries also leverage and abuse trusted processes to hide and masquerade their malware - MITRE

AV Detection Methods

AV software will typically utilize signature, heuristic and behaviour based detection

1. Signature based detection: An AV signature is an unique sequence of bytes that uniquely identifies malwares. As a result, you will have to ensure that your obfuscated exploit or payload doesn't match any known signature in the AV database.
	We can bypass signature based detection by modifuing the malware's byte sequence, therefore changing the signature.
2. Heuristic based detection: Relies on rules or decisions to determine whether a binary is malicious. It looks for specific patterns within the code or program calls
3. Behaviour based detection: Relie on identifying malware by monitoring it's behaviour. (Used for newer strains of malware)

On disk evasion techniques:

- Obfuscation Obfuscation refers to the process of concealing something important, valuable, or critical. Obfuscation reorganizes code in order to make it harder to analyze or RE.
- Encoding: Encoding data is a process invloving changing data into a new format using a scheme. encoding is a reversible process data can be encoded to a new format and decoded to its original format.
- Packing - Generate executable with new binary structure with a smaller size and therefore provides the payload with a new signature.
- Crypters - Encrypts code or payload and decrypts the encrypted code in memory. The decryption key/function is usually stored in a stub.

In memory evasion techniques:

- Focuses on manipulation of memory and does not write files to disk
- Injects payload into a process by leveraging various Windows APIs
- Payload is then executed in memory in a separate thread.

Obfuscating PowerShell Code:

- Obfuscation refers to the process of concealing something important, valuable, or critical. Obfuscation reorganizes code in order to make it harder to analyze or RE.
- As a penetration tester, you will find yourself working with Powershell code frequently. Most AV solutions will immediately flag malicious PowerShell code, as a result, you must be able to obfuscate/encode your PowerShell code and scripts in order to avoid detection.

Invoke-Obfuscation is an open source PowerShell v2.0+ compatible PowerShell command and script obfuscator

gitHub: https://github.com/danielbohannon/Invoke-Obfuscation


Need to check the tool once again while I am going through the revision.