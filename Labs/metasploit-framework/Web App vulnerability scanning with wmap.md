#### WMAP

- WMAP is a powerful, feature rich web application vulnerability scanner that can be used to automate web server enumeration and scan web applications for vulnerabilities
- WMAP is available as an MSF plugin and can be loaded directly info MSF
- WMAP is fully integrated with MSF, which consequently allows us to perform web app vulnerability scanning from within the MSF.

[[ip]]

```
root@attackdefense:~# ip a
1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet 127.0.0.1/8 scope host lo
       valid_lft forever preferred_lft forever
2: ip_vti0@NONE: <NOARP> mtu 1480 qdisc noop state DOWN group default qlen 1000
    link/ipip 0.0.0.0 brd 0.0.0.0
18340: eth0@if18341: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP group default 
    link/ether 02:42:0a:01:00:08 brd ff:ff:ff:ff:ff:ff link-netnsid 0
    inet 10.1.0.8/16 brd 10.1.255.255 scope global eth0
       valid_lft forever preferred_lft forever
18343: eth1@if18344: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP group default 
    link/ether 02:42:c0:fb:41:02 brd ff:ff:ff:ff:ff:ff link-netnsid 0
    inet 192.251.65.2/24 brd 192.251.65.255 scope global eth1
       valid_lft forever preferred_lft forever
```

[[ping]]

```
root@attackdefense:~# ping -c 5 192.251.65.3
PING 192.251.65.3 (192.251.65.3) 56(84) bytes of data.
64 bytes from 192.251.65.3: icmp_seq=1 ttl=64 time=0.094 ms
64 bytes from 192.251.65.3: icmp_seq=2 ttl=64 time=0.060 ms
64 bytes from 192.251.65.3: icmp_seq=3 ttl=64 time=0.043 ms
64 bytes from 192.251.65.3: icmp_seq=4 ttl=64 time=0.037 ms
64 bytes from 192.251.65.3: icmp_seq=5 ttl=64 time=0.039 ms

--- 192.251.65.3 ping statistics ---
5 packets transmitted, 5 received, 0% packet loss, time 107ms
rtt min/avg/max/mdev = 0.037/0.054/0.094/0.022 ms
```

[[metasploit]]

```
root@attackdefense:~# service postgresql status
11/main (port 5432): down
root@attackdefense:~# service postgresql start && msfconsole
[ ok ] Starting PostgreSQL 11 database server: main.
       =[ metasploit v5.0.18-dev                          ]
+ -- --=[ 1882 exploits - 1062 auxiliary - 328 post       ]
+ -- --=[ 546 payloads - 44 encoders - 10 nops            ]
+ -- --=[ 2 evasion                                       ]

msf5 > workspace -a wmap_enum
[*] Added workspace: wmap_enum
[*] Workspace: wmap_enum
msf5 > workspace
  default
* wmap_enum
msf5 > db_status
[*] Connected to msf. Connection type: postgresql.
msf5 > 
```

```
msf5 > setg rhost 192.251.65.3
rhost => 192.251.65.3
msf5 > setg rhosts 192.251.65.3
rhosts => 192.251.65.3
msf5 > load wmap

.-.-.-..-.-.-..---..---.
| | | || | | || | || |-'
`-----'`-'-'-'`-^-'`-'
[WMAP 1.5.1] ===  et [  ] metasploit.com 2012
[*] Successfully loaded plugin: wmap
msf5 > 
```

```
msf5 > wmap_
wmap_modules  wmap_nodes    wmap_run      wmap_sites    wmap_targets  wmap_vulns    
msf5 > wmap_sites -h
[*] Usage: wmap_sites [options]
        -h        Display this help text
        -a [url]  Add site (vhost,url)
        -d [ids]  Delete sites (separate ids with space)
        -l        List all available sites
        -s [id]   Display site structure (vhost,url|ids) (level) (unicode output true/false)

msf5 > wmap -a 192.251.65.3
[-] Unknown command: wmap.
msf5 > wmap_sites -a 192.251.65.3
[*] Site created.
msf5 > wmap_targets -h
[*] Usage: wmap_targets [options]
        -h              Display this help text
        -t [urls]       Define target sites (vhost1,url[space]vhost2,url) 
        -d [ids]        Define target sites (id1, id2, id3 ...)
        -c              Clean target sites list
        -l              List all target sites

msf5 > wmap_targets -t http://192.251.65.3
msf5 > wmap_run -h
[*] Usage: wmap_run [options]
        -h                        Display this help text
        -t                        Show all enabled modules
        -m [regex]                Launch only modules that name match provided regex.
        -p [regex]                Only test path defined by regex.
        -e [/path/to/profile]     Launch profile modules against all matched targets.
                                  (No profile file runs all enabled modules.)

msf5 > wmap_run -t
[*] Testing target:
[*]     Site: 192.251.65.3 (192.251.65.3)
[*]     Port: 80 SSL: false
============================================================
[*] Testing started. 2023-08-02 08:32:12 +0000
[*] Loading wmap modules...
[*] 39 wmap enabled modules loaded.
[*] 
=[ SSL testing ]=
============================================================
[*] Target is not SSL. SSL modules disabled.
[*] 
=[ Web Server testing ]=
============================================================
[*] Module auxiliary/scanner/http/http_version
[*] Module auxiliary/scanner/http/open_proxy
[*] Module auxiliary/admin/http/tomcat_administration
[*] Module auxiliary/admin/http/tomcat_utf8_traversal
[*] Module auxiliary/scanner/http/drupal_views_user_enum
[*] Module auxiliary/scanner/http/frontpage_login
[*] Module auxiliary/scanner/http/host_header_injection
[*] Module auxiliary/scanner/http/options
[*] Module auxiliary/scanner/http/robots_txt
[*] Module auxiliary/scanner/http/scraper
[*] Module auxiliary/scanner/http/svn_scanner
[*] Module auxiliary/scanner/http/trace
[*] Module auxiliary/scanner/http/vhost_scanner
[*] Module auxiliary/scanner/http/webdav_internal_ip
[*] Module auxiliary/scanner/http/webdav_scanner
[*] Module auxiliary/scanner/http/webdav_website_content
[*] 
=[ File/Dir testing ]=
============================================================
[*] Module auxiliary/scanner/http/backup_file
[*] Module auxiliary/scanner/http/brute_dirs
[*] Module auxiliary/scanner/http/copy_of_file
[*] Module auxiliary/scanner/http/dir_listing
[*] Module auxiliary/scanner/http/dir_scanner
[*] Module auxiliary/scanner/http/dir_webdav_unicode_bypass
[*] Module auxiliary/scanner/http/file_same_name_dir
[*] Module auxiliary/scanner/http/files_dir
[*] Module auxiliary/scanner/http/http_put
[*] Module auxiliary/scanner/http/ms09_020_webdav_unicode_bypass
[*] Module auxiliary/scanner/http/prev_dir_same_name_file
[*] Module auxiliary/scanner/http/replace_ext
[*] Module auxiliary/scanner/http/soap_xml
[*] Module auxiliary/scanner/http/trace_axd
[*] Module auxiliary/scanner/http/verb_auth_bypass
[*] 
=[ Unique Query testing ]=
============================================================
[*] Module auxiliary/scanner/http/blind_sql_query
[*] Module auxiliary/scanner/http/error_sql_injection
[*] Module auxiliary/scanner/http/http_traversal
[*] Module auxiliary/scanner/http/rails_mass_assignment
[*] Module exploit/multi/http/lcms_php_exec
[*] 
=[ Query testing ]=
============================================================
[*] 
=[ General testing ]=
============================================================
[*] Done.
```

```
msf5 > wmap_run -e
[*] Using ALL wmap enabled modules.
[-] NO WMAP NODES DEFINED. Executing local modules
[*] Testing target:
[*]     Site: 192.251.65.3 (192.251.65.3)
[*]     Port: 80 SSL: false
============================================================
[*] Testing started. 2023-08-02 08:34:08 +0000
[*] 
=[ SSL testing ]=
============================================================
[*] Target is not SSL. SSL modules disabled.
[*] 
=[ Web Server testing ]=
============================================================
[*] Module auxiliary/scanner/http/http_version

[+] 192.251.65.3:80 Apache/2.4.18 (Ubuntu)
[*] Module auxiliary/scanner/http/open_proxy
[*] Module auxiliary/admin/http/tomcat_administration
[*] Module auxiliary/admin/http/tomcat_utf8_traversal
[*] Attempting to connect to 192.251.65.3:80
[+] No File(s) found
[*] Module auxiliary/scanner/http/drupal_views_user_enum
[-] 192.251.65.3 does not appear to be vulnerable, will not continue
[*] Module auxiliary/scanner/http/frontpage_login
[*] 192.251.65.3:80       - http://192.251.65.3/ may not support FrontPage Server Extensions
[*] Module auxiliary/scanner/http/host_header_injection
[*] Module auxiliary/scanner/http/options
[+] 192.251.65.3 allows POST,OPTIONS,GET,HEAD methods
[*] Module auxiliary/scanner/http/robots_txt
[*] [192.251.65.3] /robots.txt found
[+] Contents of Robots.txt:
# robots.txt for attackdefense 
User-agent: test                     
# Directories
Allow: /webmail

User-agent: *
# Directories
Disallow: /data
Disallow: /secure

[*] Module auxiliary/scanner/http/scraper
[+] [192.251.65.3] / [Apache2 Ubuntu Default Page: It works]
[*] Module auxiliary/scanner/http/svn_scanner
[*] Using code '404' as not found.
[*] Module auxiliary/scanner/http/trace
[*] Module auxiliary/scanner/http/vhost_scanner
[*] [192.251.65.3] Sending request with random domain PeyHN. 
[*] [192.251.65.3] Sending request with random domain kplxF. 
[*] Module auxiliary/scanner/http/webdav_internal_ip
[*] Module auxiliary/scanner/http/webdav_scanner
[*] 192.251.65.3 (Apache/2.4.18 (Ubuntu)) WebDAV disabled.
[*] Module auxiliary/scanner/http/webdav_website_content
[*] 
=[ File/Dir testing ]=
============================================================
[*] Module auxiliary/scanner/http/backup_file
[*] Module auxiliary/scanner/http/brute_dirs
[*] Path: /
[*] Using code '404' as not found.
[+] Found http://192.251.65.3:80/doc/ 200
[+] Found http://192.251.65.3:80/pro/ 200
[*] Module auxiliary/scanner/http/copy_of_file
[*] Module auxiliary/scanner/http/dir_listing
[*] Path: /
[*] Module auxiliary/scanner/http/dir_scanner
[*] Path: /
[*] Detecting error code
[*] Using code '404' as not found for 192.251.65.3
[+] Found http://192.251.65.3:80/cgi-bin/ 404 (192.251.65.3)
[+] Found http://192.251.65.3:80/data/ 404 (192.251.65.3)
[+] Found http://192.251.65.3:80/doc/ 404 (192.251.65.3)
[+] Found http://192.251.65.3:80/downloads/ 404 (192.251.65.3)
[+] Found http://192.251.65.3:80/icons/ 404 (192.251.65.3)
[+] Found http://192.251.65.3:80/manual/ 404 (192.251.65.3)
[+] Found http://192.251.65.3:80/secure/ 404 (192.251.65.3)
[+] Found http://192.251.65.3:80/uploads/ 404 (192.251.65.3)
[+] Found http://192.251.65.3:80/users/ 404 (192.251.65.3)
[+] Found http://192.251.65.3:80/web_app/ 404 (192.251.65.3)
[+] Found http://192.251.65.3:80/view/ 404 (192.251.65.3)
[+] Found http://192.251.65.3:80/webadmin/ 404 (192.251.65.3)
[+] Found http://192.251.65.3:80/webdav/ 200 (192.251.65.3)
[+] Found http://192.251.65.3:80/webmail/ 200 (192.251.65.3)
[+] Found http://192.251.65.3:80/webdb/ 200 (192.251.65.3)
[+] Found http://192.251.65.3:80/~nobody/ 404 (192.251.65.3)
[+] Found http://192.251.65.3:80/~admin/ 404 (192.251.65.3)
[*] Module auxiliary/scanner/http/dir_webdav_unicode_bypass
[*] Path: /
[*] Using code '404' as not found.
[*] Found protected folder http://192.251.65.3:80/secure/ 401 (192.251.65.3)
[*]     Testing for unicode bypass in IIS6 with WebDAV enabled using PROPFIND request.
[*] Found protected folder http://192.251.65.3:80/webdav/ 401 (192.251.65.3)
[*]     Testing for unicode bypass in IIS6 with WebDAV enabled using PROPFIND request.
[*] Module auxiliary/scanner/http/file_same_name_dir
[*] Path: /
[-] Blank or default PATH set.
[*] Module auxiliary/scanner/http/files_dir
[*] Path: /
[*] Using code '404' as not found for files with extension .null
[*] Using code '404' as not found for files with extension .backup
[+] Found http://192.251.65.3:80/file.backup 200
[*] Using code '404' as not found for files with extension .bak
[*] Using code '404' as not found for files with extension .c
[+] Found http://192.251.65.3:80/code.c 200
[*] Using code '404' as not found for files with extension .cfg
[+] Found http://192.251.65.3:80/code.cfg 200
[*] Using code '404' as not found for files with extension .class
[*] Using code '404' as not found for files with extension .copy
[*] Using code '404' as not found for files with extension .conf
[*] Using code '404' as not found for files with extension .exe
[*] Using code '404' as not found for files with extension .html
[+] Found http://192.251.65.3:80/index.html 200
[*] Using code '404' as not found for files with extension .htm
[*] Using code '404' as not found for files with extension .ini
[*] Using code '404' as not found for files with extension .log
[*] Using code '404' as not found for files with extension .old
[*] Using code '404' as not found for files with extension .orig
[*] Using code '404' as not found for files with extension .php
[+] Found http://192.251.65.3:80/test.php 200
[*] Using code '404' as not found for files with extension .tar
[*] Using code '404' as not found for files with extension .tar.gz
[*] Using code '404' as not found for files with extension .tgz
[*] Using code '404' as not found for files with extension .tmp
[*] Using code '404' as not found for files with extension .temp
[*] Using code '404' as not found for files with extension .txt
[*] Using code '404' as not found for files with extension .zip
[*] Using code '404' as not found for files with extension ~
[*] Using code '404' as not found for files with extension 
[+] Found http://192.251.65.3:80/cgi-bin 301
[+] Found http://192.251.65.3:80/data 301
[+] Found http://192.251.65.3:80/downloads 301
[+] Found http://192.251.65.3:80/doc 301
[+] Found http://192.251.65.3:80/manual 301
[+] Found http://192.251.65.3:80/secure 401
[+] Found http://192.251.65.3:80/users 301
[+] Found http://192.251.65.3:80/uploads 301
[+] Found http://192.251.65.3:80/view 301
[+] Found http://192.251.65.3:80/webadmin 301
[+] Found http://192.251.65.3:80/webdav 401
[+] Found http://192.251.65.3:80/webmail 301
[+] Found http://192.251.65.3:80/~mail 403
[+] Found http://192.251.65.3:80/~admin 403
[+] Found http://192.251.65.3:80/~bin 403
[+] Found http://192.251.65.3:80/~sys 403
[*] Using code '404' as not found for files with extension 
[+] Found http://192.251.65.3:80/cgi-bin 301
[+] Found http://192.251.65.3:80/data 301
[+] Found http://192.251.65.3:80/doc 301
[+] Found http://192.251.65.3:80/downloads 301
[+] Found http://192.251.65.3:80/manual 301
[+] Found http://192.251.65.3:80/secure 401
[+] Found http://192.251.65.3:80/uploads 301
[+] Found http://192.251.65.3:80/users 301
[+] Found http://192.251.65.3:80/view 301
[+] Found http://192.251.65.3:80/webadmin 301
[+] Found http://192.251.65.3:80/webdav 401
[+] Found http://192.251.65.3:80/webmail 301
[+] Found http://192.251.65.3:80/~mail 403
[+] Found http://192.251.65.3:80/~bin 403
[+] Found http://192.251.65.3:80/~admin 403
[+] Found http://192.251.65.3:80/~sys 403
[*] Module auxiliary/scanner/http/http_put
[*] Path: /
[-] 192.251.65.3: File doesn't seem to exist. The upload probably failed
[*] Module auxiliary/scanner/http/ms09_020_webdav_unicode_bypass
[*] Path: /
[-] 192.251.65.3:80 Folder does not require authentication. [405]
[*] Module auxiliary/scanner/http/prev_dir_same_name_file
[*] Path: /
[-] Blank or default PATH set.
[*] Module auxiliary/scanner/http/replace_ext
[*] Module auxiliary/scanner/http/soap_xml
[*] Path: /
[*] Starting scan with 0ms delay between requests
[*] Server 192.251.65.3:80 returned HTTP 404 for /.  Use a different one.
[*] Module auxiliary/scanner/http/trace_axd
[*] Path: /
[*] Module auxiliary/scanner/http/verb_auth_bypass
[*] 
=[ Unique Query testing ]=
============================================================
[*] Module auxiliary/scanner/http/blind_sql_query
[*] Module auxiliary/scanner/http/error_sql_injection
[*] Module auxiliary/scanner/http/http_traversal
[*] Module auxiliary/scanner/http/rails_mass_assignment
[*] Module exploit/multi/http/lcms_php_exec
[*] 
=[ Query testing ]=
============================================================
[*] 
=[ General testing ]=
============================================================
++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
Launch completed in 229.1235146522522 seconds.
++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
[*] Done.
msf5 > 
```

```
msf5 > use auxiliary/scanner/http/http_put
msf5 auxiliary(scanner/http/http_put) > options

Module options (auxiliary/scanner/http/http_put):

   Name      Current Setting        Required  Description
   ----      ---------------        --------  -----------
   ACTION    PUT                    yes       PUT or DELETE
   FILEDATA  msf test file          no        The data to upload into the file
   FILENAME  msf_http_put_test.txt  yes       The file to attempt to write or delete
   PATH      /                      yes       The path to attempt to write or delete
   Proxies                          no        A proxy chain of format type:host:port[,type:host:port][...]
   RHOSTS    192.251.65.3           yes       The target address range or CIDR identifier
   RPORT     80                     yes       The target port (TCP)
   SSL       false                  no        Negotiate SSL/TLS for outgoing connections
   THREADS   1                      yes       The number of concurrent threads
   VHOST                            no        HTTP server virtual host


Auxiliary action:

   Name  Description
   ----  -----------
   PUT   


msf5 auxiliary(scanner/http/http_put) > set path /data/
path => /data/
msf5 auxiliary(scanner/http/http_put) > run

[+] File uploaded: http://192.251.65.3:80/data/msf_http_put_test.txt
[*] Scanned 1 of 1 hosts (100% complete)
[*] Auxiliary module execution completed
msf5 auxiliary(scanner/http/http_put) > 
```